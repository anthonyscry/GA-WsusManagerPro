<Window x:Class="WsusManager.App.Views.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="WSUS Manager"
        Width="950" Height="736"
        MinWidth="800" MinHeight="600"
        WindowStartupLocation="CenterScreen"
        ResizeMode="CanResize"
        Background="{DynamicResource PrimaryBackground}">

    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="180"/>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>

        <!-- ═══════════════════════════════════════════════════════════
             SIDEBAR
             ═══════════════════════════════════════════════════════════ -->
        <Border Grid.Column="0" Background="{DynamicResource NavBackground}"
                BorderBrush="{DynamicResource BorderPrimary}" BorderThickness="0,0,1,0">
            <DockPanel LastChildFill="False">

                <!-- Branding -->
                <StackPanel DockPanel.Dock="Top" Margin="15,16,15,8">
                    <TextBlock Text="WSUS Manager" FontSize="16" FontWeight="Bold"
                               Foreground="{DynamicResource TextPrimary}"/>
                    <TextBlock Text="{Binding VersionText}" FontSize="11"
                               Foreground="{DynamicResource TextMuted}" Margin="0,2,0,0"/>
                </StackPanel>

                <Separator DockPanel.Dock="Top" Background="{DynamicResource BorderPrimary}" Margin="15,4"/>

                <!-- SETUP Category -->
                <TextBlock DockPanel.Dock="Top" Text="SETUP" Style="{StaticResource CategoryLabel}"/>
                <Button DockPanel.Dock="Top" Content="Install WSUS"
                        Style="{StaticResource NavBtn}" x:Name="BtnInstall"
                        Command="{Binding RunInstallWsusCommand}"/>
                <Button DockPanel.Dock="Top" Content="Create GPO"
                        Style="{StaticResource NavBtn}" x:Name="BtnGpo"
                        Command="{Binding RunCreateGpoCommand}"/>

                <!-- TRANSFER Category -->
                <TextBlock DockPanel.Dock="Top" Text="TRANSFER" Style="{StaticResource CategoryLabel}"/>
                <Button DockPanel.Dock="Top" Content="Export / Import"
                        Style="{StaticResource NavBtn}" x:Name="BtnTransfer"
                        Command="{Binding RunTransferCommand}"/>

                <!-- MAINTENANCE Category -->
                <TextBlock DockPanel.Dock="Top" Text="MAINTENANCE" Style="{StaticResource CategoryLabel}"/>
                <Button DockPanel.Dock="Top" Content="Online Sync"
                        Style="{StaticResource NavBtn}" x:Name="BtnSync"
                        Command="{Binding RunOnlineSyncCommand}"/>
                <Button DockPanel.Dock="Top" Content="Schedule Task"
                        Style="{StaticResource NavBtn}" x:Name="BtnSchedule"
                        Command="{Binding RunScheduleTaskCommand}"/>

                <!-- DIAGNOSTICS Category -->
                <TextBlock DockPanel.Dock="Top" Text="DIAGNOSTICS" Style="{StaticResource CategoryLabel}"/>
                <Button DockPanel.Dock="Top" Content="Diagnostics"
                        x:Name="BtnDiagnostics"
                        Command="{Binding NavigateCommand}" CommandParameter="Diagnostics">
                    <Button.Style>
                        <Style TargetType="Button" BasedOn="{StaticResource NavBtn}">
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding CurrentPanel}" Value="Diagnostics">
                                    <Setter Property="Background" Value="{DynamicResource NavActiveBackground}"/>
                                    <Setter Property="BorderBrush" Value="{DynamicResource AccentBrush}"/>
                                    <Setter Property="BorderThickness" Value="3,0,0,0"/>
                                    <Setter Property="Foreground" Value="{DynamicResource TextPrimary}"/>
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </Button.Style>
                </Button>

                <!-- CLIENT TOOLS Category -->
                <TextBlock DockPanel.Dock="Top" Text="CLIENT TOOLS" Style="{StaticResource CategoryLabel}"/>
                <Button DockPanel.Dock="Top" Content="Client Tools"
                        x:Name="BtnClientTools"
                        Command="{Binding NavigateCommand}" CommandParameter="ClientTools">
                    <Button.Style>
                        <Style TargetType="Button" BasedOn="{StaticResource NavBtn}">
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding CurrentPanel}" Value="ClientTools">
                                    <Setter Property="Background" Value="{DynamicResource NavActiveBackground}"/>
                                    <Setter Property="BorderBrush" Value="{DynamicResource AccentBrush}"/>
                                    <Setter Property="BorderThickness" Value="3,0,0,0"/>
                                    <Setter Property="Foreground" Value="{DynamicResource TextPrimary}"/>
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </Button.Style>
                </Button>

                <!-- DATABASE Category -->
                <TextBlock DockPanel.Dock="Top" Text="DATABASE" Style="{StaticResource CategoryLabel}"/>
                <Button DockPanel.Dock="Top" Content="Database"
                        x:Name="BtnDatabase"
                        Command="{Binding NavigateCommand}" CommandParameter="Database">
                    <Button.Style>
                        <Style TargetType="Button" BasedOn="{StaticResource NavBtn}">
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding CurrentPanel}" Value="Database">
                                    <Setter Property="Background" Value="{DynamicResource NavActiveBackground}"/>
                                    <Setter Property="BorderBrush" Value="{DynamicResource AccentBrush}"/>
                                    <Setter Property="BorderThickness" Value="3,0,0,0"/>
                                    <Setter Property="Foreground" Value="{DynamicResource TextPrimary}"/>
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </Button.Style>
                </Button>

                <!-- Bottom utility buttons -->
                <StackPanel DockPanel.Dock="Bottom" Margin="0,0,0,8">
                    <Separator Background="{DynamicResource BorderPrimary}" Margin="15,4"/>
                    <Button Command="{Binding NavigateCommand}" CommandParameter="Dashboard">
                        <Button.Style>
                            <Style TargetType="Button" BasedOn="{StaticResource NavBtn}">
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding CurrentPanel}" Value="Dashboard">
                                        <Setter Property="Background" Value="{DynamicResource NavActiveBackground}"/>
                                        <Setter Property="BorderBrush" Value="{DynamicResource AccentBrush}"/>
                                        <Setter Property="BorderThickness" Value="3,0,0,0"/>
                                        <Setter Property="Foreground" Value="{DynamicResource TextPrimary}"/>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </Button.Style>
                        Dashboard
                    </Button>
                    <Button Content="Settings" Style="{StaticResource NavBtn}"
                            Command="{Binding NavigateCommand}" CommandParameter="Settings"/>
                    <Button Content="Help" Style="{StaticResource NavBtn}"
                            Command="{Binding NavigateCommand}" CommandParameter="Help"/>
                    <Button Content="About" Style="{StaticResource NavBtn}"
                            Command="{Binding NavigateCommand}" CommandParameter="About"/>
                </StackPanel>
            </DockPanel>
        </Border>

        <!-- ═══════════════════════════════════════════════════════════
             MAIN CONTENT AREA
             ═══════════════════════════════════════════════════════════ -->
        <Grid Grid.Column="1">
            <Grid.RowDefinitions>
                <!-- Header -->
                <RowDefinition Height="Auto"/>
                <!-- Content panels -->
                <RowDefinition Height="*"/>
                <!-- Log panel -->
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <!-- Header Bar -->
            <Border Grid.Row="0" Background="{DynamicResource CardBackground}"
                    BorderBrush="{DynamicResource BorderPrimary}" BorderThickness="0,0,0,1"
                    Padding="16,10">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <TextBlock Grid.Column="0" Text="{Binding PageTitle}"
                               FontSize="18" FontWeight="SemiBold"
                               Foreground="{DynamicResource TextPrimary}"
                               VerticalAlignment="Center"/>

                    <!-- Connection Status Indicator -->
                    <StackPanel Grid.Column="1" Orientation="Horizontal"
                                VerticalAlignment="Center">
                        <Ellipse Width="8" Height="8"
                                 Fill="{Binding ConnectionDotColor}"
                                 Margin="0,0,6,0"/>
                        <TextBlock Text="{Binding ConnectionStatusText}"
                                   Foreground="{DynamicResource TextSecondary}" FontSize="12"/>
                        <TextBlock Text="{Binding ModeOverrideIndicator}"
                                   Foreground="{DynamicResource TextMuted}" FontSize="11"
                                   Margin="4,0,0,0"
                                   VerticalAlignment="Center"/>
                    </StackPanel>
                </Grid>
            </Border>

            <!-- ═══════════════════════════════════════════════════════
                 CONTENT PANELS (visibility bound to CurrentPanel)
                 ═══════════════════════════════════════════════════════ -->
            <Grid Grid.Row="1">

                <!-- Dashboard Panel -->
                <Border x:Name="DashboardPanel"
                        Visibility="{Binding IsDashboardVisible}">
                    <ScrollViewer VerticalScrollBarVisibility="Auto" Padding="16">
                        <StackPanel>

                            <!-- Status Cards -->
                            <UniformGrid Rows="1" Columns="4" Margin="0,0,0,16">

                                <!-- Services Card -->
                                <Border Background="{DynamicResource CardBackground}" CornerRadius="6"
                                        Margin="0,0,8,0">
                                    <StackPanel>
                                        <Border Background="{Binding ServicesBarColor}"
                                                CornerRadius="6,6,0,0" Height="4"/>
                                        <StackPanel Margin="16,12,16,16">
                                            <TextBlock Text="SERVICES" Style="{StaticResource CardTitle}"/>
                                            <TextBlock Text="{Binding ServicesValue}"
                                                       Style="{StaticResource CardValue}" Margin="0,4,0,0"/>
                                            <TextBlock Text="{Binding ServicesSubtext}"
                                                       Style="{StaticResource CardSubtext}" Margin="0,4,0,0"/>
                                        </StackPanel>
                                    </StackPanel>
                                </Border>

                                <!-- Database Card -->
                                <Border Background="{DynamicResource CardBackground}" CornerRadius="6"
                                        Margin="4,0,4,0">
                                    <StackPanel>
                                        <Border Background="{Binding DatabaseBarColor}"
                                                CornerRadius="6,6,0,0" Height="4"/>
                                        <StackPanel Margin="16,12,16,16">
                                            <TextBlock Text="DATABASE" Style="{StaticResource CardTitle}"/>
                                            <TextBlock Text="{Binding DatabaseValue}"
                                                       Style="{StaticResource CardValue}" Margin="0,4,0,0"/>
                                            <TextBlock Text="{Binding DatabaseSubtext}"
                                                       Style="{StaticResource CardSubtext}" Margin="0,4,0,0"/>
                                        </StackPanel>
                                    </StackPanel>
                                </Border>

                                <!-- Disk Card -->
                                <Border Background="{DynamicResource CardBackground}" CornerRadius="6"
                                        Margin="4,0,4,0">
                                    <StackPanel>
                                        <Border Background="{Binding DiskBarColor}"
                                                CornerRadius="6,6,0,0" Height="4"/>
                                        <StackPanel Margin="16,12,16,16">
                                            <TextBlock Text="DISK SPACE" Style="{StaticResource CardTitle}"/>
                                            <TextBlock Text="{Binding DiskValue}"
                                                       Style="{StaticResource CardValue}" Margin="0,4,0,0"/>
                                            <TextBlock Text="{Binding DiskSubtext}"
                                                       Style="{StaticResource CardSubtext}" Margin="0,4,0,0"/>
                                        </StackPanel>
                                    </StackPanel>
                                </Border>

                                <!-- Task Card -->
                                <Border Background="{DynamicResource CardBackground}" CornerRadius="6"
                                        Margin="8,0,0,0">
                                    <StackPanel>
                                        <Border Background="{Binding TaskBarColor}"
                                                CornerRadius="6,6,0,0" Height="4"/>
                                        <StackPanel Margin="16,12,16,16">
                                            <TextBlock Text="SCHEDULED TASK" Style="{StaticResource CardTitle}"/>
                                            <TextBlock Text="{Binding TaskValue}"
                                                       Style="{StaticResource CardValue}" Margin="0,4,0,0"/>
                                            <TextBlock Text="{Binding TaskSubtext}"
                                                       Style="{StaticResource CardSubtext}" Margin="0,4,0,0"/>
                                        </StackPanel>
                                    </StackPanel>
                                </Border>

                            </UniformGrid>

                            <!-- Quick Actions -->
                            <Border Background="{DynamicResource CardBackground}" CornerRadius="6"
                                    Padding="16" Margin="0,0,0,16">
                                <StackPanel>
                                    <TextBlock Text="Quick Actions" FontSize="14" FontWeight="SemiBold"
                                               Foreground="{DynamicResource TextPrimary}" Margin="0,0,0,12"/>
                                    <WrapPanel>
                                        <Button Content="Diagnostics" Style="{StaticResource QuickActionBtn}"
                                                x:Name="QBtnDiagnostics" Margin="0,0,8,8"
                                                Command="{Binding QuickDiagnosticsCommand}"/>
                                        <Button Content="Deep Cleanup" Style="{StaticResource QuickActionBtn}"
                                                x:Name="QBtnCleanup" Margin="0,0,8,8"
                                                Command="{Binding QuickCleanupCommand}"/>
                                        <Button Content="Online Sync" Style="{StaticResource QuickActionBtn}"
                                                x:Name="QBtnSync" Margin="0,0,8,8"
                                                Command="{Binding QuickSyncCommand}"
                                                IsEnabled="{Binding IsOnline}"/>
                                        <Button Content="Start Services" Style="{StaticResource QuickActionBtn}"
                                                x:Name="QBtnStartServices" Margin="0,0,8,8"
                                                Command="{Binding QuickStartServicesCommand}"/>
                                        <Button x:Name="QBtnToggleMode"
                                                Style="{StaticResource QuickActionBtn}"
                                                Content="{Binding ToggleModeText}"
                                                Margin="0,0,8,8"
                                                Command="{Binding ToggleModeCommand}"
                                                ToolTip="Manually override Online/Air-Gap mode. Bypasses automatic network detection."/>
                                    </WrapPanel>
                                </StackPanel>
                            </Border>

                            <!-- Configuration Info -->
                            <Border Background="{DynamicResource CardBackground}" CornerRadius="6"
                                    Padding="16">
                                <StackPanel>
                                    <TextBlock Text="Configuration" FontSize="14" FontWeight="SemiBold"
                                               Foreground="{DynamicResource TextPrimary}" Margin="0,0,0,12"/>
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="140"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                        </Grid.RowDefinitions>

                                        <TextBlock Grid.Row="0" Grid.Column="0" Text="Content Path"
                                                   Foreground="{DynamicResource TextSecondary}" FontSize="12" Margin="0,0,0,6"/>
                                        <TextBlock Grid.Row="0" Grid.Column="1" Text="{Binding ConfigContentPath}"
                                                   Foreground="{DynamicResource TextPrimary}" FontSize="12" Margin="0,0,0,6"/>

                                        <TextBlock Grid.Row="1" Grid.Column="0" Text="SQL Instance"
                                                   Foreground="{DynamicResource TextSecondary}" FontSize="12" Margin="0,0,0,6"/>
                                        <TextBlock Grid.Row="1" Grid.Column="1" Text="{Binding ConfigSqlInstance}"
                                                   Foreground="{DynamicResource TextPrimary}" FontSize="12" Margin="0,0,0,6"/>

                                        <TextBlock Grid.Row="2" Grid.Column="0" Text="Log Path"
                                                   Foreground="{DynamicResource TextSecondary}" FontSize="12" Margin="0,0,0,6"/>
                                        <TextBlock Grid.Row="2" Grid.Column="1" Text="{Binding ConfigLogPath}"
                                                   Foreground="{DynamicResource TextPrimary}" FontSize="12" Margin="0,0,0,6"/>

                                        <TextBlock Grid.Row="3" Grid.Column="0" Text="Server Mode"
                                                   Foreground="{DynamicResource TextSecondary}" FontSize="12"/>
                                        <StackPanel Grid.Row="3" Grid.Column="1" Orientation="Horizontal">
                                            <TextBlock Text="{Binding ServerModeText}"
                                                       Foreground="{DynamicResource TextPrimary}" FontSize="12"/>
                                            <TextBlock Text="{Binding ModeOverrideIndicator}"
                                                       Foreground="{DynamicResource TextMuted}" FontSize="11"
                                                       Margin="6,0,0,0" VerticalAlignment="Center"/>
                                        </StackPanel>
                                    </Grid>
                                </StackPanel>
                            </Border>
                        </StackPanel>
                    </ScrollViewer>
                </Border>

                <!-- Diagnostics Panel -->
                <Border x:Name="DiagnosticsPanel"
                        Visibility="{Binding IsDiagnosticsPanelVisible}">
                    <ScrollViewer VerticalScrollBarVisibility="Auto" Padding="16">
                        <StackPanel>

                            <!-- Primary Actions -->
                            <Border Background="{DynamicResource CardBackground}" CornerRadius="6"
                                    Padding="16" Margin="0,0,0,12">
                                <StackPanel>
                                    <TextBlock Text="Diagnostics" FontSize="14" FontWeight="SemiBold"
                                               Foreground="{DynamicResource TextPrimary}" Margin="0,0,0,12"/>
                                    <TextBlock Text="Run a comprehensive health check of all WSUS components. Failed checks are automatically repaired where possible."
                                               Foreground="{DynamicResource TextSecondary}" FontSize="12"
                                               TextWrapping="Wrap" Margin="0,0,0,12"/>
                                    <WrapPanel>
                                        <Button Content="Run Diagnostics" Style="{StaticResource BtnGreen}"
                                                Padding="16,8" Margin="0,0,8,0"
                                                Command="{Binding RunDiagnosticsCommand}"
                                                IsEnabled="{Binding IsWsusInstalled}"/>
                                        <Button Content="Reset Content" Style="{StaticResource BtnSec}"
                                                Padding="16,8" ToolTip="Runs wsusutil reset to re-verify content files (use after air-gap import)"
                                                Command="{Binding ResetContentCommand}"
                                                IsEnabled="{Binding IsWsusInstalled}"/>
                                    </WrapPanel>
                                </StackPanel>
                            </Border>

                            <!-- Service Control -->
                            <Border Background="{DynamicResource CardBackground}" CornerRadius="6"
                                    Padding="16">
                                <StackPanel>
                                    <TextBlock Text="Service Control" FontSize="14" FontWeight="SemiBold"
                                               Foreground="{DynamicResource TextPrimary}" Margin="0,0,0,12"/>
                                    <TextBlock Text="Start or stop individual WSUS services. Services are managed in dependency order."
                                               Foreground="{DynamicResource TextSecondary}" FontSize="12"
                                               TextWrapping="Wrap" Margin="0,0,0,12"/>

                                    <!-- SQL Server Row -->
                                    <Grid Margin="0,0,0,8">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>
                                        <StackPanel Grid.Column="0" VerticalAlignment="Center">
                                            <TextBlock Text="SQL Server Express" FontSize="13"
                                                       Foreground="{DynamicResource TextPrimary}"/>
                                            <TextBlock Text="MSSQL$SQLEXPRESS" FontSize="11"
                                                       Foreground="{DynamicResource TextMuted}"/>
                                        </StackPanel>
                                        <Button Grid.Column="1" Content="Start" Style="{StaticResource BtnGreen}"
                                                Padding="12,4" Margin="0,0,6,0"
                                                Command="{Binding StartServiceCommand}"
                                                CommandParameter="MSSQL$SQLEXPRESS"
                                                IsEnabled="{Binding IsWsusInstalled}"/>
                                        <Button Grid.Column="2" Content="Stop" Style="{StaticResource BtnRed}"
                                                Padding="12,4"
                                                Command="{Binding StopServiceCommand}"
                                                CommandParameter="MSSQL$SQLEXPRESS"
                                                IsEnabled="{Binding IsWsusInstalled}"/>
                                    </Grid>

                                    <Separator Background="{DynamicResource BorderPrimary}" Margin="0,4"/>

                                    <!-- IIS Row -->
                                    <Grid Margin="0,8,0,8">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>
                                        <StackPanel Grid.Column="0" VerticalAlignment="Center">
                                            <TextBlock Text="IIS (World Wide Web)" FontSize="13"
                                                       Foreground="{DynamicResource TextPrimary}"/>
                                            <TextBlock Text="W3SVC" FontSize="11"
                                                       Foreground="{DynamicResource TextMuted}"/>
                                        </StackPanel>
                                        <Button Grid.Column="1" Content="Start" Style="{StaticResource BtnGreen}"
                                                Padding="12,4" Margin="0,0,6,0"
                                                Command="{Binding StartServiceCommand}"
                                                CommandParameter="W3SVC"
                                                IsEnabled="{Binding IsWsusInstalled}"/>
                                        <Button Grid.Column="2" Content="Stop" Style="{StaticResource BtnRed}"
                                                Padding="12,4"
                                                Command="{Binding StopServiceCommand}"
                                                CommandParameter="W3SVC"
                                                IsEnabled="{Binding IsWsusInstalled}"/>
                                    </Grid>

                                    <Separator Background="{DynamicResource BorderPrimary}" Margin="0,4"/>

                                    <!-- WSUS Row -->
                                    <Grid Margin="0,8,0,0">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>
                                        <StackPanel Grid.Column="0" VerticalAlignment="Center">
                                            <TextBlock Text="WSUS Service" FontSize="13"
                                                       Foreground="{DynamicResource TextPrimary}"/>
                                            <TextBlock Text="WsusService" FontSize="11"
                                                       Foreground="{DynamicResource TextMuted}"/>
                                        </StackPanel>
                                        <Button Grid.Column="1" Content="Start" Style="{StaticResource BtnGreen}"
                                                Padding="12,4" Margin="0,0,6,0"
                                                Command="{Binding StartServiceCommand}"
                                                CommandParameter="WsusService"
                                                IsEnabled="{Binding IsWsusInstalled}"/>
                                        <Button Grid.Column="2" Content="Stop" Style="{StaticResource BtnRed}"
                                                Padding="12,4"
                                                Command="{Binding StopServiceCommand}"
                                                CommandParameter="WsusService"
                                                IsEnabled="{Binding IsWsusInstalled}"/>
                                    </Grid>

                                </StackPanel>
                            </Border>

                        </StackPanel>
                    </ScrollViewer>
                </Border>

                <!-- Database Operations Panel -->
                <Border x:Name="DatabasePanel"
                        Visibility="{Binding IsDatabasePanelVisible}">
                    <ScrollViewer VerticalScrollBarVisibility="Auto" Padding="16">
                        <StackPanel>

                            <!-- DB Size Info -->
                            <Border Background="{DynamicResource CardBackground}" CornerRadius="6"
                                    Padding="16" Margin="0,0,0,12">
                                <StackPanel>
                                    <TextBlock Text="Database Size" FontSize="14" FontWeight="SemiBold"
                                               Foreground="{DynamicResource TextPrimary}" Margin="0,0,0,6"/>
                                    <TextBlock Text="{Binding DatabaseValue}"
                                               FontSize="22" FontWeight="Bold"
                                               Foreground="{DynamicResource TextPrimary}"/>
                                    <TextBlock Text="{Binding DatabaseSubtext}"
                                               Foreground="{DynamicResource TextSecondary}" FontSize="12"
                                               Margin="0,4,0,0"/>
                                </StackPanel>
                            </Border>

                            <!-- Deep Cleanup -->
                            <Border Background="{DynamicResource CardBackground}" CornerRadius="6"
                                    Padding="16" Margin="0,0,0,12">
                                <StackPanel>
                                    <TextBlock Text="Deep Cleanup" FontSize="14" FontWeight="SemiBold"
                                               Foreground="{DynamicResource TextPrimary}" Margin="0,0,0,8"/>
                                    <TextBlock TextWrapping="Wrap" FontSize="12"
                                               Foreground="{DynamicResource TextSecondary}" Margin="0,0,0,12"
                                               Text="Runs the full 6-step cleanup pipeline: WSUS built-in cleanup, remove supersession records, delete declined updates, rebuild indexes, and shrink the database."/>
                                    <Button Content="Run Deep Cleanup" Style="{StaticResource BtnGreen}"
                                            Padding="16,8" HorizontalAlignment="Left"
                                            Command="{Binding RunDeepCleanupCommand}"
                                            IsEnabled="{Binding IsWsusInstalled}"/>
                                </StackPanel>
                            </Border>

                            <!-- Backup Database -->
                            <Border Background="{DynamicResource CardBackground}" CornerRadius="6"
                                    Padding="16" Margin="0,0,0,12">
                                <StackPanel>
                                    <TextBlock Text="Backup Database" FontSize="14" FontWeight="SemiBold"
                                               Foreground="{DynamicResource TextPrimary}" Margin="0,0,0,8"/>
                                    <TextBlock TextWrapping="Wrap" FontSize="12"
                                               Foreground="{DynamicResource TextSecondary}" Margin="0,0,0,12"
                                               Text="Creates a compressed SQL backup of SUSDB. You will be prompted to choose a destination file. Requires SQL sysadmin permissions."/>
                                    <Button Content="Backup Database" Style="{StaticResource BtnSec}"
                                            Padding="16,8" HorizontalAlignment="Left"
                                            Command="{Binding BackupDatabaseCommand}"
                                            IsEnabled="{Binding IsWsusInstalled}"/>
                                </StackPanel>
                            </Border>

                            <!-- Restore Database -->
                            <Border Background="{DynamicResource CardBackground}" CornerRadius="6"
                                    Padding="16">
                                <StackPanel>
                                    <TextBlock Text="Restore Database" FontSize="14" FontWeight="SemiBold"
                                               Foreground="{DynamicResource TextPrimary}" Margin="0,0,0,8"/>
                                    <TextBlock TextWrapping="Wrap" FontSize="12"
                                               Foreground="{DynamicResource TextSecondary}" Margin="0,0,0,4"
                                               Text="Restores SUSDB from a backup file. WSUS and IIS services will be stopped during restore."/>
                                    <TextBlock TextWrapping="Wrap" FontSize="12" FontWeight="SemiBold"
                                               Foreground="{DynamicResource TextSecondary}" Margin="0,0,0,12"
                                               Text="WARNING: This replaces all current WSUS data."/>
                                    <Button Content="Restore Database" Style="{StaticResource BtnSec}"
                                            Padding="16,8" HorizontalAlignment="Left"
                                            Command="{Binding RestoreDatabaseCommand}"
                                            IsEnabled="{Binding IsWsusInstalled}"/>
                                </StackPanel>
                            </Border>

                        </StackPanel>
                    </ScrollViewer>
                </Border>

                <!-- Client Tools Panel -->
                <Border x:Name="ClientToolsPanel"
                        Visibility="{Binding IsClientToolsPanelVisible}">
                    <ScrollViewer VerticalScrollBarVisibility="Auto" Padding="16">
                        <StackPanel>

                            <!-- Target Host -->
                            <Border Background="{DynamicResource CardBackground}" CornerRadius="6"
                                    Padding="16" Margin="0,0,0,12">
                                <StackPanel>
                                    <TextBlock Text="Target Host" FontSize="14" FontWeight="SemiBold"
                                               Foreground="{DynamicResource TextPrimary}" Margin="0,0,0,8"/>
                                    <TextBlock Text="Enter the hostname of the client machine to manage. Operations use WinRM (Windows Remote Management)."
                                               Foreground="{DynamicResource TextSecondary}" FontSize="12"
                                               TextWrapping="Wrap" Margin="0,0,0,12"/>
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="80"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>
                                        <TextBlock Grid.Column="0" Text="Hostname:"
                                                   Foreground="{DynamicResource TextSecondary}" FontSize="13"
                                                   VerticalAlignment="Center"/>
                                        <TextBox Grid.Column="1"
                                                 Text="{Binding ClientHostname, UpdateSourceTrigger=PropertyChanged}"
                                                 Background="{DynamicResource InputBackground}"
                                                 Foreground="{DynamicResource TextPrimary}"
                                                 BorderBrush="{DynamicResource BorderPrimary}"
                                                 Padding="8,6" FontSize="13"/>
                                    </Grid>
                                </StackPanel>
                            </Border>

                            <!-- Remote Operations -->
                            <Border Background="{DynamicResource CardBackground}" CornerRadius="6"
                                    Padding="16" Margin="0,0,0,12">
                                <StackPanel>
                                    <TextBlock Text="Remote Operations" FontSize="14" FontWeight="SemiBold"
                                               Foreground="{DynamicResource TextPrimary}" Margin="0,0,0,12"/>
                                    <WrapPanel>
                                        <Button Content="Cancel Stuck Jobs" Style="{StaticResource BtnSec}"
                                                Padding="16,8" Margin="0,0,8,8"
                                                Command="{Binding RunClientCancelStuckJobsCommand}"
                                                ToolTip="Stop WU services, clear cache, restart — fixes stuck update jobs"/>
                                        <Button Content="Force Check-In" Style="{StaticResource BtnSec}"
                                                Padding="16,8" Margin="0,0,8,8"
                                                Command="{Binding RunClientForceCheckInCommand}"
                                                ToolTip="Run gpupdate, resetauthorization, detectnow, reportnow"/>
                                        <Button Content="Test Connectivity" Style="{StaticResource BtnSec}"
                                                Padding="16,8" Margin="0,0,8,8"
                                                Command="{Binding RunClientTestConnectivityCommand}"
                                                ToolTip="Test TCP connection from client to WSUS server on ports 8530/8531"/>
                                        <Button Content="Run Diagnostics" Style="{StaticResource BtnGreen}"
                                                Padding="16,8" Margin="0,0,8,8"
                                                Command="{Binding RunClientDiagnosticsCommand}"
                                                ToolTip="Gather WSUS settings, service status, last check-in, reboot state"/>
                                    </WrapPanel>
                                </StackPanel>
                            </Border>

                            <!-- Mass Operations -->
                            <Border Background="{DynamicResource CardBackground}" CornerRadius="6"
                                    Padding="16" Margin="0,0,0,12">
                                <StackPanel>
                                    <TextBlock Text="Mass Operations" FontSize="14" FontWeight="SemiBold"
                                               Foreground="{DynamicResource TextPrimary}" Margin="0,0,0,8"/>
                                    <TextBlock Text="Enter hostnames (one per line, or comma-separated) or load from a text file. Mass GPUpdate runs gpupdate + WSUS check-in on every host."
                                               Foreground="{DynamicResource TextSecondary}" FontSize="12"
                                               TextWrapping="Wrap" Margin="0,0,0,12"/>
                                    <TextBox Text="{Binding MassHostnames, UpdateSourceTrigger=PropertyChanged}"
                                             Background="{DynamicResource InputBackground}"
                                             Foreground="{DynamicResource TextPrimary}"
                                             BorderBrush="{DynamicResource BorderPrimary}"
                                             Padding="8,6" FontSize="12" FontFamily="Consolas"
                                             AcceptsReturn="True" TextWrapping="Wrap"
                                             MinHeight="80" MaxHeight="150"
                                             VerticalScrollBarVisibility="Auto"/>
                                    <WrapPanel Margin="0,8,0,0">
                                        <Button Content="Load from File" Style="{StaticResource BtnSec}"
                                                Padding="16,8" Margin="0,0,8,0"
                                                Command="{Binding LoadHostFileCommand}"
                                                ToolTip="Load hostnames from a text file (one per line)"/>
                                        <Button Content="Mass GPUpdate" Style="{StaticResource BtnGreen}"
                                                Padding="16,8" Margin="0,0,8,0"
                                                Command="{Binding RunMassGpUpdateCommand}"
                                                ToolTip="Run gpupdate + WSUS check-in on all listed hosts"/>
                                    </WrapPanel>
                                </StackPanel>
                            </Border>

                            <!-- Script Generator -->
                            <Border Background="{DynamicResource CardBackground}" CornerRadius="6"
                                    Padding="16" Margin="0,0,0,12">
                                <StackPanel>
                                    <TextBlock Text="Script Generator" FontSize="14" FontWeight="SemiBold"
                                               Foreground="{DynamicResource TextPrimary}" Margin="0,0,0,8"/>
                                    <TextBlock Text="Generate a ready-to-run PowerShell script for environments where WinRM is unavailable. Copy the script to the target host and run it as Administrator."
                                               Foreground="{DynamicResource TextSecondary}" FontSize="12"
                                               TextWrapping="Wrap" Margin="0,0,0,12"/>
                                    <Grid Margin="0,0,0,8">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="90"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>
                                        <TextBlock Grid.Column="0" Text="Operation:"
                                                   Foreground="{DynamicResource TextSecondary}" FontSize="13"
                                                   VerticalAlignment="Center"/>
                                        <ComboBox Grid.Column="1"
                                                  ItemsSource="{Binding ScriptOperations}"
                                                  SelectedItem="{Binding SelectedScriptOperation}"
                                                  Background="{DynamicResource InputBackground}"
                                                  Foreground="{DynamicResource TextPrimary}"
                                                  BorderBrush="{DynamicResource BorderPrimary}"
                                                  Padding="8,6" FontSize="13"/>
                                    </Grid>
                                    <Button Content="Generate Script" Style="{StaticResource BtnSec}"
                                            Padding="16,8" HorizontalAlignment="Left"
                                            Command="{Binding GenerateScriptCommand}"
                                            ToolTip="Generate a PowerShell script file for the selected operation"/>
                                </StackPanel>
                            </Border>

                            <!-- Error Code Lookup -->
                            <Border Background="{DynamicResource CardBackground}" CornerRadius="6"
                                    Padding="16">
                                <StackPanel>
                                    <TextBlock Text="Error Code Lookup" FontSize="14" FontWeight="SemiBold"
                                               Foreground="{DynamicResource TextPrimary}" Margin="0,0,0,8"/>
                                    <TextBlock Text="Enter a WSUS or Windows Update error code (e.g., 0x80072EE2) to see its description and recommended fix."
                                               Foreground="{DynamicResource TextSecondary}" FontSize="12"
                                               TextWrapping="Wrap" Margin="0,0,0,12"/>
                                    <Grid Margin="0,0,0,8">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="90"/>
                                            <ColumnDefinition Width="200"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>
                                        <TextBlock Grid.Column="0" Text="Error Code:"
                                                   Foreground="{DynamicResource TextSecondary}" FontSize="13"
                                                   VerticalAlignment="Center"/>
                                        <TextBox Grid.Column="1"
                                                 Text="{Binding ErrorCodeInput, UpdateSourceTrigger=PropertyChanged}"
                                                 Background="{DynamicResource InputBackground}"
                                                 Foreground="{DynamicResource TextPrimary}"
                                                 BorderBrush="{DynamicResource BorderPrimary}"
                                                 Padding="8,6" FontSize="13"/>
                                        <Button Grid.Column="2" Content="Lookup" Style="{StaticResource BtnSec}"
                                                Padding="16,6" Margin="8,0,0,0"
                                                Command="{Binding LookupErrorCodeCommand}"/>
                                    </Grid>
                                    <TextBox Text="{Binding ErrorCodeResult, Mode=OneWay}"
                                             Background="{DynamicResource PrimaryBackground}"
                                             Foreground="{DynamicResource TextPrimary}"
                                             BorderThickness="0"
                                             FontFamily="Consolas" FontSize="12"
                                             IsReadOnly="True" TextWrapping="Wrap"
                                             Padding="8" MinHeight="60"/>
                                </StackPanel>
                            </Border>

                        </StackPanel>
                    </ScrollViewer>
                </Border>

                <!-- Generic Operation Panel (placeholder for other panels) -->
                <Border x:Name="OperationPanel"
                        Visibility="{Binding IsOperationPanelVisible}">
                    <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                        <TextBlock Text="{Binding PageTitle}" FontSize="20"
                                   Foreground="{DynamicResource TextSecondary}"
                                   HorizontalAlignment="Center"/>
                        <TextBlock Text="This operation will be available in a future update."
                                   Foreground="{DynamicResource TextMuted}" FontSize="13"
                                   Margin="0,8,0,0" HorizontalAlignment="Center"/>
                    </StackPanel>
                </Border>

            </Grid>

            <!-- ═══════════════════════════════════════════════════════
                 LOG PANEL
                 ═══════════════════════════════════════════════════════ -->
            <Border Grid.Row="2" Background="{DynamicResource CardBackground}"
                    BorderBrush="{DynamicResource BorderPrimary}" BorderThickness="0,1,0,0">
                <DockPanel>
                    <!-- Log Header -->
                    <Border DockPanel.Dock="Top" Background="{DynamicResource NavBackground}"
                            Padding="12,6">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>

                            <StackPanel Grid.Column="0" Orientation="Horizontal"
                                        VerticalAlignment="Center">
                                <TextBlock Text="Output Log" FontSize="12" FontWeight="SemiBold"
                                           Foreground="{DynamicResource TextPrimary}" Margin="0,0,12,0"/>
                                <TextBlock Text="{Binding CurrentOperationName}"
                                           FontSize="11" Foreground="{DynamicResource TextSecondary}"/>
                            </StackPanel>

                            <!-- Progress bar and step text (shown during operations) -->
                            <StackPanel Grid.Column="1" Orientation="Horizontal"
                                        VerticalAlignment="Center" Margin="8,0"
                                        Visibility="{Binding ProgressBarVisibility}">
                                <ProgressBar IsIndeterminate="True"
                                             Width="120" Height="3"
                                             Margin="0,0,8,0"
                                             VerticalAlignment="Center"/>
                                <TextBlock Text="{Binding OperationStepText}"
                                           FontSize="11" Foreground="{DynamicResource TextSecondary}"
                                           VerticalAlignment="Center" MaxWidth="200"
                                           TextTrimming="CharacterEllipsis"/>
                            </StackPanel>

                            <StackPanel Grid.Column="2" Orientation="Horizontal">
                                <Button Content="Cancel" Style="{StaticResource BtnRed}"
                                        Padding="10,4" FontSize="11" Margin="0,0,8,0"
                                        Command="{Binding CancelOperationCommand}"
                                        Visibility="{Binding CancelButtonVisibility}"/>
                                <Button Content="{Binding LogToggleText}" Style="{StaticResource BtnSec}"
                                        Padding="10,4" FontSize="11" Margin="0,0,4,0"
                                        Command="{Binding ToggleLogPanelCommand}"/>
                                <Button Content="Clear" Style="{StaticResource BtnSec}"
                                        Padding="10,4" FontSize="11" Margin="0,0,4,0"
                                        Command="{Binding ClearLogCommand}"/>
                                <Button Content="Save" Style="{StaticResource BtnSec}"
                                        Padding="10,4" FontSize="11"
                                        Command="{Binding SaveLogCommand}"/>
                            </StackPanel>
                        </Grid>
                    </Border>

                    <!-- Status Banner (shown after operation completes) -->
                    <Border DockPanel.Dock="Top"
                            Background="{Binding StatusBannerColor}"
                            Padding="12,5"
                            Visibility="{Binding StatusBannerVisibility}">
                        <TextBlock Text="{Binding StatusBannerText}"
                                   Foreground="White" FontSize="12"
                                   FontWeight="SemiBold"/>
                    </Border>

                    <!-- Log Text Area -->
                    <TextBox DockPanel.Dock="Bottom"
                             Style="{StaticResource LogTextBox}"
                             Text="{Binding LogOutput, Mode=OneWay}"
                             Height="{Binding LogPanelHeight}"
                             Visibility="{Binding LogTextVisibility}"
                             x:Name="LogTextBox"
                             TextChanged="LogTextBox_TextChanged"/>
                </DockPanel>
            </Border>

            <!-- Status Bar -->
            <Border Grid.Row="2" VerticalAlignment="Bottom"
                    Background="{DynamicResource NavBackground}"
                    Padding="12,4" Visibility="Collapsed">
                <TextBlock Text="{Binding StatusMessage}"
                           Foreground="{DynamicResource TextSecondary}" FontSize="11"/>
            </Border>

        </Grid>
    </Grid>
</Window>

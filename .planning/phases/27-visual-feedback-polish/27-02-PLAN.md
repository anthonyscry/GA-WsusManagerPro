---
phase: 27-visual-feedback-polish
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/WsusManager.App/Views/MainWindow.xaml
  - src/WsusManager.App/ViewModels/MainViewModel.cs
autonomous: true
requirements:
  - UX-07

must_haves:
  truths:
    - "Operation buttons show visual loading indicator when operation is in progress"
    - "Loading indicator is visible in status area during operations"
    - "Buttons are disabled (greyed out) while operation runs"
    - "Loading indicator disappears when operation completes"
  artifacts:
    - path: "src/WsusManager.App/Views/MainWindow.xaml"
      provides: "Visual loading indicator UI elements"
      contains: "ProgressBar with IsIndeterminate=true"
    - path: "src/WsusManager.App/ViewModels/MainViewModel.cs"
      provides: "Loading state management"
      exports: ["IsOperationRunning", "ProgressBarVisibility"]
  key_links:
    - from: "MainWindow.xaml ProgressBar"
      to: "MainViewModel.IsOperationRunning"
      via: "Visibility binding"
      pattern: "Visibility.*IsOperationRunning"
---

<objective>
Add visual loading indicators to operation buttons and status area so users have clear feedback when operations are in progress.

Purpose: Users need immediate visual confirmation that their action was registered and the system is working. This prevents double-clicks and reduces perceived latency.

Output: Indeterminate progress spinner appears in status area during operations; buttons show disabled state.
</objective>

<execution_context>
@/home/anthonyscry/.claude/get-shit-done/workflows/execute-plan.md
@/home/anthonyscry/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/STATE.md
@.planning/phases/27-visual-feedback-polish/27-CONTEXT.md
@src/WsusManager.App/Views/MainWindow.xaml
@src/WsusManager.App/ViewModels/MainViewModel.cs
</context>

<tasks>

<task type="auto">
  <name>Add loading spinner to status area in MainWindow.xaml</name>
  <files>src/WsusManager.App/Views/MainWindow.xaml</files>
  <action>
    Add a circular progress spinner to the status area (header bar) that appears during operations:

    1. Find the ConnectionStatus StackPanel in header bar (around line 193-205)
    2. Add a ProgressBar before the ConnectionDot Ellipse:
       ```xml
       <!-- Loading Spinner (shown during operations) -->
       <ProgressBar Width="16" Height="16"
                    IsIndeterminate="True"
                    Visibility="{Binding ProgressBarVisibility}"
                    Margin="0,0,8,0"
                    VerticalAlignment="Center"/>
       ```

    3. The existing ProgressBarVisibility property (line 304-305 in MainViewModel) already controls visibility based on IsOperationRunning

    DO NOT: Add spinner to individual buttons — use StatusMessage area for centralized loading indicator per CONTEXT.md decision
  </action>
  <verify>
    dotnet build src/WsusManager.App/WsusManager.App.csproj succeeds, ProgressBar appears in header during operations
  </verify>
  <done>
    Indeterminate ProgressBar visible in header status area during operations, hidden when idle
  </done>
</task>

<task type="auto">
  <name>Update StatusMessage prefix to show "Loading..." during operations</name>
  <files>src/WsusManager.App/ViewModels/MainViewModel.cs</files>
  <action>
    Update RunOperationAsync to show "Loading..." prefix in StatusMessage during operations:

    1. In RunOperationAsync (around line 344), find: `StatusMessage = $"Running: {operationName}...";`
    2. Change to: `StatusMessage = $"Loading: {operationName}...";` to align with CONTEXT.md decision
    3. This works with existing loading spinner — the spinner provides visual cue, text provides operation context

    DO NOT: Add separate loading state property — reuse existing StatusMessage and IsOperationRunning
  </action>
  <verify>
    dotnet build src/WsusManager.App/WsusManager.App.csproj succeeds, StatusMessage shows "Loading: [Operation]..." during operations
  </verify>
  <done>
    StatusMessage displays "Loading: [Operation Name]..." prefix while operation runs, providing clear text feedback alongside visual spinner
  </done>
</task>

<task type="auto">
  <name>Verify button disabled state is working correctly during operations</name>
  <files>src/WsusManager.App/ViewModels/MainViewModel.cs</files>
  <action>
    Verify existing button disabling mechanism is correctly implemented:

    1. Confirm NotifyCommandCanExecuteChanged() is called in RunOperationAsync (around line 351) — this already exists
    2. Confirm all operation RelayCommand attributes have CanExecute methods:
       - CanExecuteWsusOperation() returns !IsOperationRunning (line 898)
       - CanExecuteOnlineOperation() returns !IsOperationRunning (line 900)
       - CanExecuteInstall() returns !IsOperationRunning (line 902)
    3. These are already implemented and working — buttons automatically disable when IsOperationRunning = true

    NO CODE CHANGES NEEDED — this is verification that existing infrastructure works correctly

    DO NOT: Add IsEnabled bindings to individual buttons — RelayCommand CanExecute handles this automatically
  </action>
  <verify>
    Review MainViewModel confirms all CanExecute methods check IsOperationRunning, buttons disable during operations
  </verify>
  <done>
    Verified existing button disabling mechanism works correctly — all operation buttons become disabled (greyed out) when IsOperationRunning = true
  </done>
</task>

</tasks>

<verification>
1. Build succeeds: dotnet build src/WsusManager.App
2. Loading spinner appears in header status area during operations
3. StatusMessage shows "Loading: [Operation]..." prefix
4. All operation buttons are disabled while operation runs
5. Spinner disappears when operation completes
6. StatusMessage returns to ready/idle state when operation completes
</verification>

<success_criteria>
Visual loading indicators provide clear feedback during operations. Users see an indeterminate progress spinner in the status area and "Loading: [Operation]..." message while buttons are disabled, preventing duplicate clicks.
</success_criteria>

<output>
After completion, create `.planning/phases/27-visual-feedback-polish/27-02-SUMMARY.md`
</output>

---
phase: 27-visual-feedback-polish
plan: 03
type: execute
wave: 2
depends_on: ["27-02"]
files_modified:
  - src/WsusManager.App/ViewModels/MainViewModel.cs
  - src/WsusManager.Core/Services/HealthService.cs
  - src/WsusManager.Core/Services/DeepCleanupService.cs
  - src/WsusManager.Core/Services/SyncService.cs
autonomous: true
requirements:
  - UX-08

must_haves:
  truths:
    - "Error messages include specific next steps (e.g., 'Start SQL service', 'Run Repair Health')"
    - "Error messages use three-part format: what failed, why it matters, specific action to resolve"
    - "Error messages use imperative verbs (Start, Run, Check, Enable)"
    - "Common errors (SQL connection, WinRM, services) have actionable guidance"
  artifacts:
    - path: "src/WsusManager.Core/Services/HealthService.cs"
      provides: "Actionable error messages for health check failures"
      contains: "To fix:|To resolve:"
    - path: "src/WsusManager.Core/Services/DeepCleanupService.cs"
      provides: "Actionable error messages for cleanup failures"
      contains: "To fix:|To resolve:"
    - path: "src/WsusManager.App/ViewModels/MainViewModel.cs"
      provides: "Error message formatting in UI"
      exports: ["RunOperationAsync error handling"]
  key_links:
    - from: "Service error results"
      to: "MainViewModel.RunOperationAsync"
      via: "Result.Message or Result.Error"
      pattern: "result\\.Success.*false|catch.*Exception"
---

<objective>
Implement actionable error messages that include specific next steps for resolving common failure scenarios.

Purpose: Generic error messages leave users stuck wondering what to do next. Actionable guidance reduces support burden and speeds up resolution time.

Output: Error messages follow three-part format: (1) What failed, (2) Why it matters, (3) Specific action to resolve.
</objective>

<execution_context>
@/home/anthonyscry/.claude/get-shit-done/workflows/execute-plan.md
@/home/anthonyscry/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/STATE.md
@.planning/phases/27-visual-feedback-polish/27-CONTEXT.md
@src/WsusManager.Core/Services/HealthService.cs
@src/WsusManager.Core/Services/DeepCleanupService.cs
@src/WsusManager.Core/Services/SyncService.cs
</context>

<tasks>

<task type="auto">
  <name>Add actionable error messages to HealthService for common failure scenarios</name>
  <files>src/WsusManager.Core/Services/HealthService.cs</files>
  <action>
    Update HealthService to return actionable error messages with specific next steps:

    1. Find error cases in RunDiagnosticsAsync (SQL connection failures, service not running, permission issues)

    2. Update error messages to include "To fix:" section with specific actions:
       - SQL connection failed: "Could not connect to SQL Server. To fix: 1) Start SQL Server service, 2) Run Repair Health"
       - Service not running: "WSUS service is not running. To fix: Start 'WsusService' from Services panel or Diagnostics"
       - Permission denied: "Access denied. To fix: Run as Administrator, check folder permissions"
       - WinRM not enabled: "WinRM is not enabled on remote machine. To fix: Enable WinRM via 'winrm quickconfig' or Group Policy"

    3. Use Result&lt;T&gt;.Error() or append to Message property with "\n\nTo fix: ..." format

    DO NOT: Create new error types — extend existing Result.Message property with actionable guidance
  </action>
  <verify>
    dotnet build src/WsusManager.Core/WsusManager.Core.csproj succeeds, error messages include "To fix:" sections
  </verify>
  <done>
    HealthService returns actionable error messages for SQL, service, permission, and WinRM failures with specific "To fix:" steps
  </done>
</task>

<task type="auto">
  <name>Add actionable error messages to DeepCleanupService for database operations</name>
  <files>src/WsusManager.Core/Services/DeepCleanupService.cs</files>
  <action>
    Update DeepCleanupService to return actionable error messages for database cleanup failures:

    1. Find error cases in RunAsync method (sysadmin permissions, backup conflicts, database corruption)

    2. Update error messages:
       - Not sysadmin: "Requires SQL sysadmin permission. To fix: Add user to sysadmin role in SQL Server Management Studio"
       - Backup in progress: "Cannot shrink during backup. To fix: Wait for backup to complete, then retry Deep Cleanup"
       - Database space: "Database file too large. To fix: Run Deep Cleanup, then check available disk space"

    3. Follow CONTEXT.md pattern: Error: [specific error]\n\nTo fix: [actionable step]

    DO NOT: Add complex error code lookup — keep messages simple and direct
  </action>
  <verify>
    dotnet build src/WsusManager.Core/WsusManager.Core.csproj succeeds, database errors include actionable guidance
  </verify>
  <done>
    DeepCleanupService returns actionable error messages for sysadmin, backup conflict, and space issues
  </done>
</task>

<task type="auto">
  <name>Add actionable error messages to SyncService for online sync failures</name>
  <files>src/WsusManager.Core/Services/SyncService.cs</files>
  <action>
    Update SyncService to return actionable error messages for sync failures:

    1. Find error cases in RunSyncAsync (network offline, WSUS API errors, timeout)

    2. Update error messages:
       - Network offline: "Cannot reach Microsoft Update servers. To fix: Check internet connection, verify proxy settings"
       - WSUS API error: "WSUS API returned error. To fix: Restart WSUS Server service, run Diagnostics"
       - Timeout: "Operation timed out. To fix: Check network connectivity, try Quick Sync instead of Full Sync"

    3. Ensure messages use imperative verbs: Check, Restart, Run, Verify, Enable

    DO NOT: Include generic "contact support" messages — always provide specific actionable steps first
  </action>
  <verify>
    dotnet build src/WsusManager.Core/WsusManager.Core.csproj succeeds, sync errors include actionable steps
  </verify>
  <done>
    SyncService returns actionable error messages for network, API, and timeout failures with specific remediation steps
  </done>
</task>

</tasks>

<verification>
1. Build succeeds: dotnet build src/WsusManager.Core
2. HealthService error messages include "To fix:" sections
3. DeepCleanupService error messages include "To fix:" sections
4. SyncService error messages include "To fix:" sections
5. Error messages use imperative verbs (Start, Run, Check, Enable)
6. Messages follow three-part format: what failed, why it matters, specific action
</verification>

<success_criteria>
Error messages include specific next steps for resolving common failures. Users see actionable guidance like "Start SQL service" or "Run Repair Health" instead of generic error descriptions.
</success_criteria>

<output>
After completion, create `.planning/phases/27-visual-feedback-polish/27-03-SUMMARY.md`
</output>

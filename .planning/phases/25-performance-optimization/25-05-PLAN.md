---
phase: 25-performance-optimization
plan: 05
type: execute
wave: 3
depends_on: []
files_modified:
  - src/WsusManager.App/Views/MainWindow.xaml
  - src/WsusManager.App/ViewModels/MainViewModel.cs
autonomous: true
requirements: [PERF-09]

must_haves:
  truths:
    - "Lists displaying 2000+ items render without UI freezing using virtualization"
    - "VirtualizingStackPanel enabled on all ListBox/ItemsControl elements"
    - "Scroll performance remains smooth with large datasets"
    - "Memory usage stays constant regardless of list size (only visible items loaded)"
  artifacts:
    - path: "src/WsusManager.App/Views/MainWindow.xaml"
      provides: "Virtualization enabled on all list controls"
      contains: "VirtualizingStackPanel|VirtualizingPanel"
    - path: "src/WsusManager.App/ViewModels/MainViewModel.cs"
      provides: "ObservableCollection properties for list data"
      contains: "ObservableCollection"
  key_links:
    - from: "src/WsusManager.App/Views/MainWindow.xaml"
      to: "src/WsusManager.App/ViewModels/MainViewModel.cs"
      via: "ItemsSource bindings for list data"
      pattern: "ItemsSource=\"{Binding.*List"
---

<objective>
Enable list virtualization for any ListBox/ItemsControl elements to handle 2000+ items without UI freezing. Add VirtualizingPanel properties to ensure only visible items are rendered, keeping memory usage constant and scroll performance smooth.

Purpose: Current codebase doesn't have large list displays (dashboard shows summary cards), but future phases (29 - Data Filtering) will add filtered computer/update lists. Virtualization infrastructure prepares for these features and ensures any existing lists are optimized.

Output: All list controls have VirtualizingPanel.IsVirtualizing="True" and VirtualizationMode="Recycling" enabled.
</objective>

<execution_context>
@/home/anthonyscry/.claude/get-shit-done/workflows/execute-plan.md
@/home/anthonyscry/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@src/WsusManager.App/Views/MainWindow.xaml
@src/WsusManager.App/ViewModels/MainViewModel.cs

Current state:
- MainWindow.xaml has no ListBox or ListView controls (dashboard shows cards only)
- Client Tools panel uses TextBox for hostname input (not a list)
- Phase 29 (Data Filtering) will add computer/update lists requiring virtualization

Per user decision (25-CONTEXT.md):
- Use WPF's built-in VirtualizingStackPanel for Lists/ListBoxes (no third-party dependencies)
- Enable VirtualizingPanel.IsVirtualizing="True" and VirtualizingPanel.VirtualizationMode="Recycling"
- Apply to Computers panel and Updates panel (handles 2000+ items)
- Keep item templates simple to avoid layout thrashing

This plan is proactive infrastructure for future phases — ensuring virtualization patterns are established before large lists are added.
</context>

<tasks>

<task type="auto">
  <name>Task 1: Audit MainWindow.xaml for list controls requiring virtualization</name>
  <files>src/WsusManager.App/Views/MainWindow.xaml</files>
  <action>
    Audit MainWindow.xaml for any list controls that need virtualization:

    1. Search for list control patterns:
       - `<ListBox`
       - `<ListView`
       - `<ItemsControl`
       - `<DataGrid` (future use)
       - `ItemsSource="{Binding"` bindings that might return collections

    2. Document findings:
       - If no list controls exist, document that this plan establishes infrastructure for Phase 29
       - If ComboBoxes exist, check if they bind to large collections (>100 items)

    3. Create a template/placeholder comment for future list virtualization:
       - Add XML comment in MainWindow.xaml after Client Tools panel (around line 708):
       ```xml
       <!-- ═══════════════════════════════════════════════════════
            PHASE 29: Data Filtering - Add virtualized lists here

            Example pattern for large computer/update lists:
            <ListBox VirtualizingPanel.IsVirtualizing="True"
                     VirtualizingPanel.VirtualizationMode="Recycling"
                     ItemsSource="{Binding FilteredComputers}"
                     ItemTemplate="{StaticResource ComputerItemTemplate}" />
       ═══════════════════════════════════════════════════════ -->
       ```

    This establishes the pattern for future phases while documenting current state.
  </action>
  <verify>
    Build: `dotnet build src/WsusManager.App/WsusManager.App.csproj --configuration Release` should succeed.
  </verify>
  <done>
    MainWindow.xaml audited for list controls, virtualization pattern documented for Phase 29.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add virtualization helper style to SharedStyles.xaml</name>
  <files>src/WsusManager.App/Themes/SharedStyles.xaml</files>
  <action>
    Add a reusable style for virtualized lists to SharedStyles.xaml:

    1. Add style after existing button styles (around line 150 or end of file):
       ```xml
       <!-- ═══════════════════════════════════════════════════════
            VIRTUALIZED LIST STYLES (Phase 25: Performance)
            ═══════════════════════════════════════════════════════ -->
       <Style x:Key="VirtualizedListBox" TargetType="ListBox">
           <Setter Property="VirtualizingPanel.IsVirtualizing" Value="True" />
           <Setter Property="VirtualizingPanel.VirtualizationMode" Value="Recycling" />
           <Setter Property="VirtualizingPanel.ScrollUnit" Value="Pixel" />
           <Setter Property="Background" Value="{DynamicResource CardBackground}" />
           <Setter Property="BorderBrush" Value="{DynamicResource BorderPrimary}" />
           <Setter Property="BorderThickness" Value="1" />
           <Setter Property="Foreground" Value="{DynamicResource TextPrimary}" />
           <Setter Property="FontFamily" Value="Segoe UI" />
           <Setter Property="FontSize" Value="12" />
           <Setter Property="Padding" Value="8" />
       </Style>

       <Style x:Key="VirtualizedListView" TargetType="ListView" BasedOn="{StaticResource VirtualizedListBox}">
           <Setter Property="GridView.ColumnHeaderContainerStyle">
               <Setter.Value>
                   <Style TargetType="GridViewColumnHeader">
                       <Setter Property="Background" Value="{DynamicResource NavBackground}" />
                       <Setter Property="Foreground" Value="{DynamicResource TextSecondary}" />
                       <Setter Property="FontWeight" Value="SemiBold" />
                       <Setter Property="Padding" Value="8,6" />
                       <Setter Property="BorderBrush" Value="{DynamicResource BorderPrimary}" />
                       <Setter Property="BorderThickness" Value="0,0,0,1" />
                   </Style>
               </Setter.Value>
           </Setter>
       </Style>
       ```

    2. This provides pre-configured styles for Phase 29 to use when adding computer/update lists
    3. VirtualizationMode="Recycling" reuses container elements for better performance

    This ensures consistent virtualization patterns across future list implementations.
  </action>
  <verify>
    Build: `dotnet build src/WsusManager.App/WsusManager.App.csproj --configuration Release` should succeed.
  </verify>
  <done>
    SharedStyles.xaml includes VirtualizedListBox and VirtualizedListView styles with recycling enabled.
  </done>
</task>

<task type="auto">
  <name>Task 3: Add ObservableCollection infrastructure to MainViewModel</name>
  <files>src/WsusManager.App/ViewModels/MainViewModel.cs</files>
  <action>
    Add ObservableCollection properties and infrastructure for future list data:

    1. Add using statement at top if not present:
       ```csharp
       using System.Collections.ObjectModel;
       ```

    2. Add observable collection properties near dashboard properties (around line 450):
       ```csharp
       // ═══════════════════════════════════════════════════════════════
       // DATA LISTS (Phase 25: Virtualization Infrastructure)
       // ═══════════════════════════════════════════════════════════════

       [ObservableProperty]
       private ObservableCollection<ComputerInfo> _filteredComputers = new();

       [ObservableProperty]
       private ObservableCollection<UpdateInfo> _filteredUpdates = new();
       ```

    3. Add record types for list items (at bottom of file or near other records):
       ```csharp
       /// <summary>
       /// Represents a computer in the WSUS environment with filtering properties.
       /// Used by Phase 29 Data Filtering panel with virtualized ListBox.
       /// </summary>
       public record ComputerInfo(
           string Hostname,
           string IpAddress,
           string Status,
           DateTime LastSync,
           int PendingUpdates,
           string OsVersion);

       /// <summary>
       /// Represents an update with filtering properties.
       /// Used by Phase 29 Data Filtering panel with virtualized ListBox.
       /// </summary>
       public record UpdateInfo(
           Guid UpdateId,
           string Title,
           string? KbArticle,
           string Classification,
           DateTime ApprovalDate,
           bool IsApproved,
           bool IsDeclined);
       ```

    4. Add methods to populate collections (placeholder for Phase 29):
       ```csharp
       /// <summary>
       /// Loads computers into filtered collection. Called by Phase 29 Data Filtering.
       /// Currently empty placeholder - implementation in Phase 29.
       /// </summary>
       public async Task LoadComputersAsync(string? statusFilter = null, CancellationToken ct = default)
       {
           // Phase 29 will implement: query WSUS API, apply filter, populate FilteredComputers
           await Task.CompletedTask;
       }

       /// <summary>
       /// Loads updates into filtered collection. Called by Phase 29 Data Filtering.
       /// Currently empty placeholder - implementation in Phase 29.
       /// </summary>
       public async Task LoadUpdatesAsync(string? approvalFilter = null, string? classificationFilter = null, CancellationToken ct = default)
       {
           // Phase 29 will implement: query DashboardService, apply filters, populate FilteredUpdates
           await Task.CompletedTask;
       }
       ```

    This establishes the data structure infrastructure that Phase 29 will implement.
  </action>
  <verify>
    Build: `dotnet build src/WsusManager.App/WsusManager.App.csproj --configuration Release` should succeed.
  </verify>
  <done>
    MainViewModel has ObservableCollection properties and placeholder methods for Phase 29.
  </done>
</task>

</tasks>

<verification>
After completing all tasks:
1. Build: `dotnet build src/WsusManager.App/WsusManager.App.csproj --configuration Release`
2. Verify: SharedStyles.xaml compiles with new styles
3. Verify: MainViewModel compiles with ObservableCollection properties
4. Verify: MainWindow.xaml comment block present for Phase 29 reference
5. Check: No StaticResource references in new styles (all use DynamicResource)
</verification>

<success_criteria>
1. MainWindow.xaml documents virtualization pattern for Phase 29
2. SharedStyles.xaml provides VirtualizedListBox and VirtualizedListView styles
3. MainViewModel has ObservableCollection infrastructure (FilteredComputers, FilteredUpdates)
4. Placeholder methods exist for Phase 29 to implement
5. No new compiler warnings
6. All theme bindings use DynamicResource
</success_criteria>

<output>
After completion, create `.planning/phases/25-performance-optimization/25-05-SUMMARY.md` with:
- List control audit findings (current state: no lists, infrastructure ready)
- Style additions to SharedStyles.xaml
- ObservableCollection infrastructure added
- Note: Full implementation deferred to Phase 29 (Data Filtering)
</output>

# Phase 24-03: API Documentation (DocFX)

**Created:** 2026-02-21
**Status:** Ready for implementation
**Requirements:** DOC-03

## Overview

Generate API reference documentation website from XML documentation comments using DocFX. The HTML output will be browsable, searchable, and can be hosted on GitHub Pages or static hosting.

## Current State

- **XML documentation:** Added in Phase 20 (QUAL-04, QUAL-05)
- **XML doc generation:** Enabled in .csproj files (`GenerateDocumentationFile=true`)
- **DocFX:** Not yet configured

## Target State

- **DocFX configured:** `docfx/docfx.json` with project metadata
- **API reference generated:** HTML documentation in `docs/api/` directory
- **Searchable:** Full-text search across all APIs
- **Browsable:** Navigation by namespace, class, and member
- **Cross-referenced:** `<see cref=""/>` links work between APIs

## Success Criteria

1. DocFX configuration files created and valid
2. Running `docfx build` generates HTML without errors
3. Generated HTML opens in browser and shows API documentation
4. Navigation works (namespaces, classes, members)
5. Search functionality works
6. `<see cref=""/>` references resolve correctly

## Implementation Plan

### Step 1: Install DocFX

**Option A: Global install (recommended)**
```bash
# Download DocFX from GitHub Releases
# https://github.com/dotnet/docfx/releases
# Extract to PATH (e.g., C:\Tools\docfx)

# Or via chocolatey
choco install docfx

# Verify installation
docfx --version
```

**Option B: Local tool (alternative)**
```bash
# Create tool-manifest if not exists
dotnet new tool-manifest

# Install DocFX as local tool
dotnet tool install docfx

# Run via dotnet tool
dotnet docfx --version
```

### Step 2: Create DocFX Configuration

**File:** `docfx/docfx.json`

**Content:**
```json
{
  "metadata": [
    {
      "src": [
        {
          "files": [
            "src/WsusManager.Core/WsusManager.Core.csproj",
            "src/WsusManager.App/WsusManager.App.csproj"
          ],
          "exclude": [
            "**/bin/**",
            "**/obj/**",
            "**/Tests/**"
          ]
        }
      ],
      "dest": "docfx/api",
      "filter": "docfx/filterConfig.yml"
    }
  ],
  "build": {
    "content": [
      {
        "files": [
          "docfx/api/**.yml",
          "docfx/api/index.md"
        ]
      },
      {
        "files": [
          "docs/articles/**/*.md",
          "docs/toc.yml"
        ]
      }
    ],
    "dest": "docs/api",
    "globalMetadata": {
      "_appName": "WSUS Manager API Reference",
      "_appTitle": "WSUS Manager",
      "_enableSearch": true,
      "_gitUrl": "https://github.com/anthonyscry/GA-WsusManager",
      "_gitContribute": {
        "branch": "main"
      }
    },
    "overwrite": [
      {
        "files": [
          "docfx/overwrite/*.md"
        ],
        "exclude": [
          "docfx/overwrite/README.md"
        ]
      }
    ],
    "xref": [
      "https://learn.microsoft.com/en-us/dotnet/api/xrefmap.yml"
    ]
  }
}
```

### Step 3: Create Filter Configuration

**File:** `docfx/filterConfig.yml`

**Purpose:** Exclude internal APIs from documentation

**Content:**
```yaml
## api filter for excluding unwanted members
# Exclude by member name
apiRules:
- exclude:
    uidRegex: ^.*Internal$
    type: Namespace
- exclude:
    uidRegex: ^.*\.Internal$
    type: Class
    typeKind: Class
- exclude:
    hasAttribute:
      uid: System.ComponentModel.EditorBrowsableAttribute
    type: Member
```

### Step 4: Create Index Page

**File:** `docfx/api/index.md`

**Content:**
```markdown
# WSUS Manager API Reference

Welcome to the WSUS Manager API documentation. This site provides comprehensive reference documentation for all public APIs in WsusManager.Core and WsusManager.App.

## Getting Started

- **[WsusManager.Core](xref:WsusManager.Core)** - Core library with business logic, services, and models
- **[WsusManager.App](xref:WsusManager.App)** - WPF application with ViewModels and Views

## Key Namespaces

### WsusManager.Core.Services

Service interfaces and implementations for WSUS operations:

- **[IHealthService](xref:WsusManager.Core.Services.IHealthService)** - Health check and diagnostics
- **[IDatabaseService](xref:WsusManager.Core.Services.IDatabaseService)** - Database operations (cleanup, restore)
- **[IWsusService](xref:WsusManager.Core.Services.IWsusService)** - WSUS operations (sync, export, import)
- **[IServiceManager](xref:WsusManager.Core.Services.IServiceManager)** - Windows service management
- **[IFirewallService](xref:WsusManager.Core.Services.IFirewallService)** - Firewall rule management
- **[IClientManagementService](xref:WsusManager.Core.Services.IClientManagementService)** - WinRM client operations

### WsusManager.Core.Models

Data models for WSUS entities:

- **[HealthCheckResult](xref:WsusManager.Core.Models.HealthCheckResult)** - Health check results
- **[DatabaseBackupInfo](xref:WsusManager.Core.Models.DatabaseBackupInfo)** - Database backup metadata
- **[WsusClient](xref:WsusManager.Core.Models.WsusClient)** - WSUS client information
- **[SyncProfile](xref:WsusManager.Core.Models.SyncProfile)** - Sync configuration profiles

### WsusManager.App.ViewModels

MVVM view models for UI logic:

- **[MainViewModel](xref:WsusManager.App.ViewModels.MainViewModel)** - Main application view model
- **[SettingsViewModel](xref:WsusManager.App.ViewModels.SettingsViewModel)** - Settings dialog view model
- **[DiagnosticsViewModel](xref:WsusManager.App.ViewModels.DiagnosticsViewModel)** - Diagnostics panel view model

## Architecture

WSUS Manager follows the MVVM pattern with CommunityToolkit.Mvvm:

1. **Models** (WsusManager.Core) - Business entities
2. **Services** (WsusManager.Core) - Business logic and external operations
3. **ViewModels** (WsusManager.App) - UI state and commands
4. **Views** (WsusManager.App) - XAML UI definition

For more details, see [Architecture Documentation](../architecture.md).

## Version

Current API documentation is for **WSUS Manager v4.4.0**.

## License

This project is proprietary software developed for GA-ASI internal use.
```

### Step 5: Create Table of Contents

**File:** `docs/toc.yml`

**Purpose:** Navigation structure for documentation site

**Content:**
```yaml
- name: API Reference
  href: api/
  homepage: api/index.html
```

### Step 6: Add Overwrite Files (Optional)

**Purpose:** Add custom content to generated API pages

**File:** `docfx/overwrite/README.md`

**Content:**
```markdown
---
uid: WsusManager.Core
summary: *content
---

# WsusManager.Core Namespace

Core library containing business logic, services, and models for WSUS operations.

## Key Components

- **Services**: Business logic interfaces and implementations
- **Models**: Data transfer objects and entities
- **Infrastructure**: Logging, admin checks, path validation

This library has no UI dependencies and can be used independently for testing or automation.
```

### Step 7: Build API Documentation

**Command:**
```bash
# From repository root
docfx docfx/docfx.json --serve

# Or build without serving
docfx docfx/docfx.json
```

**Expected output:**
```
Build succeeded.
  - api/index.html
  - api/xref.html
  ...
Documentation website generated at:
  docs/api/index.html

Serving the documentation at:
  http://localhost:8080
```

### Step 8: Verify Output

**Manual verification:**
1. Open `docs/api/index.html` in browser
2. Verify namespaces are listed (WsusManager.Core, WsusManager.Core.Services, etc.)
3. Click on a service interface (e.g., IHealthService)
4. Verify summary, methods, parameters, returns, and exceptions are shown
5. Test search functionality (search for "HealthService")
6. Verify `<see cref=""/>` links work (click on a cref link)

**Expected issues to fix:**
- Missing XML comments show as "No documentation"
- Broken cref links show as red text
- Internal APIs may appear (use filterConfig.yml to exclude)

### Step 9: Add to CI/CD (Optional for v4.4)

**File:** `.github/workflows/build-csharp.yml`

**Add step after build:**
```yaml
- name: Generate API Documentation
  if: github.event_name == 'push' && github.ref == 'refs/heads/main'
  run: |
    dotnet tool install -g docfx
    docfx docfx/docfx.json

- name: Upload API Documentation
  if: github.event_name == 'push' && github.ref == 'refs/heads/main'
  uses: actions/upload-artifact@v4
  with:
    name: api-docs
    path: docs/api/
```

**Note:** GitHub Pages deployment is deferred to post-v4.4 (per Phase 24 Context, "Deployment: GitHub Pages or static hosting (optional)")

### Step 10: Document API Doc Generation

**File:** `docs/api/README.md`

**Content:**
```markdown
# API Documentation

This directory contains generated API reference documentation.

## Regenerating Documentation

To regenerate the API documentation after code changes:

```bash
# Install DocFX (first time only)
dotnet tool install -g docfx

# Generate documentation
docfx docfx/docfx.json

# View locally (auto-opens browser)
docfx docfx/docfx.json --serve
```

## Documentation Source

API documentation is generated from XML documentation comments in the source code. To update API documentation:

1. Edit XML comments in `.cs` files
2. Rebuild the solution
3. Run `docfx docfx/docfx.json`
4. Commit generated changes

## Adding XML Documentation

All public APIs should have XML documentation comments:

```csharp
/// <summary>
/// Brief summary of what this API does.
/// </summary>
/// <param name="paramName">Description of parameter.</param>
/// <returns>Description of return value.</returns>
/// <exception cref="T:System.ExceptionType">Condition when thrown.</exception>
public async Task<Result> MyApiAsync(string paramName, CancellationToken cancellationToken)
{
    // ...
}
```

See Phase 20 (XML Documentation & API Reference) for XML documentation guidelines.

## Hosting

### GitHub Pages (Future)

To host on GitHub Pages:

1. Enable GitHub Pages for repository (Settings â†’ Pages)
2. Set source to `docs/` folder
3. Push to main branch
4. Documentation publishes automatically

### Local Viewing

Open `docs/api/index.html` in a web browser to view documentation locally.

## Versioning

API documentation is version-specific. Each release generates documentation for that version:

- v4.4.0: Current stable release
- Older versions: Archived in separate branches if needed
```

## Dependencies

- **Phase 20 (XML Documentation):** Must be complete for API docs to generate
- **DocFX:** Must be installed (globally or as local tool)

## Verification

**Manual verification steps:**
1. Run `docfx docfx/docfx.json` - should succeed without errors
2. Open `docs/api/index.html` in browser - should load and show content
3. Navigate to a service interface - should show methods with documentation
4. Test search - should find APIs by name
5. Click a `<see cref=""/>` link - should navigate to referenced API

**Acceptance criteria:**
- [ ] DocFX configuration files created (docfx.json, filterConfig.yml)
- [ ] API index page created (docfx/api/index.md)
- [ ] `docfx build` runs without errors
- [ ] Generated HTML opens in browser
- [ ] All public services have generated documentation pages
- [ ] Search functionality works
- [ ] Cross-references (cref links) resolve correctly

## Notes

- DocFX can be noisy - filter warnings are normal
- Internal APIs may appear even with filter - this is acceptable for v4.4
- Complex generics may not render perfectly - acceptable limitation
- DocFX templates can be customized for branding (deferred to post-v4.4)
- GitHub Pages deployment is nice-to-have but not required for v4.4

## Future Enhancements

- Custom DocFX template for GA-ASI branding
- GitHub Actions auto-deploy to GitHub Pages
- Version selector for multiple API versions
- Article pages for architectural overviews
- Code examples in API documentation (currently excluded per Phase 20 Context)

---

*Plan: 24-03-PLAN.md*
*Phase: 24-documentation-generation*
*Created: 2026-02-21*

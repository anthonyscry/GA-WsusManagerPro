# Phase 24-04: CI/CD Pipeline Documentation

**Created:** 2026-02-21
**Status:** Ready for implementation
**Requirements:** DOC-04

## Overview

Document the GitHub Actions CI/CD workflows with explanations of what each workflow does, when it runs, and what artifacts it produces. This documentation ensures the CI/CD pipeline is transparent and maintainable.

## Current State

**Workflows in `.github/workflows/`:**
- `build-csharp.yml` - C# build, test, publish
- `release-csharp.yml` - C# release automation
- `build-powershell.yml` - Legacy PowerShell build

**Documentation status:** Mentioned in CONTRIBUTING.md but not fully documented

## Target State

- **Dedicated CI/CD doc:** `docs/ci-cd.md` with workflow explanations
- **Workflow diagrams:** Visual representation of pipeline stages
- **Troubleshooting guide:** Common CI/CD issues and solutions
- **CONTRIBUTING.md updated:** References detailed CI/CD doc

## Success Criteria

1. CI/CD documentation file created (`docs/ci-cd.md`)
2. All workflows documented with purpose, triggers, and outputs
3. Workflow diagram shows pipeline flow
4. Troubleshooting guide covers common issues
5. CONTRIBUTING.md references detailed doc
6. New contributors can understand CI/CD without reading YAML files

## Implementation Plan

### Step 1: Create CI/CD Documentation File

**File:** `docs/ci-cd.md`

**Content:**
```markdown
# CI/CD Pipeline Documentation

WSUS Manager uses GitHub Actions for continuous integration (CI) and continuous deployment (CD). This document explains the workflows, when they run, and what they produce.

## Workflow Overview

```
┌─────────────────────────────────────────────────────────────────┐
│                     GitHub Actions Workflows                     │
├─────────────────────────────────────────────────────────────────┤
│                                                                   │
│  Push/PR to main                                                  │
│  ┌──────────────────────────────────────┐                       │
│  │   Build C# WSUS Manager               │                       │
│  │   - Restore, build, test              │                       │
│  │   - Code coverage                     │                       │
│  │   - Publish single-file EXE           │                       │
│  └──────────────────────────────────────┘                       │
│                     │                                            │
│                     ▼                                            │
│              Artifacts Produced                                   │
│              - test-results (TRX)                                │
│              - coverage-report (HTML)                            │
│              - wsusmanager-exe (ZIP)                             │
│                                                                   │
│  Git Tag Push (e.g., v4.4.0)                                      │
│  ┌──────────────────────────────────────┐                       │
│  │   Release C# WSUS Manager             │                       │
│  │   - Build, test                      │                       │
│  │   - Create GitHub release            │                       │
│  │   - Upload EXE as asset              │                       │
│  └──────────────────────────────────────┘                       │
│                     │                                            │
│                     ▼                                            │
│              GitHub Release Created                               │
│                                                                   │
└─────────────────────────────────────────────────────────────────┘
```

## Workflows

### Build C# WSUS Manager

**File:** `.github/workflows/build-csharp.yml`

**Purpose:** Build, test, and package C# application on every push and pull request.

**Triggers:**
- Push to `main` branch
- Pull request to `main` branch
- Manual trigger (workflow_dispatch)

**Steps:**
1. **Checkout** - Clone repository
2. **Setup .NET** - Install .NET 8 SDK
3. **Restore** - Restore NuGet packages
4. **Build** - Build solution in Release configuration
5. **Test** - Run xUnit tests with code coverage
6. **Publish** - Publish single-file EXE (win-x64)
7. **Upload artifacts** - Save test results, coverage report, and EXE

**Artifacts:**
- `test-results` - xUnit test results (TRX format)
- `coverage-report` - HTML coverage report
- `wsusmanager-exe` - Single-file EXE (ZIP archive)

**Status:** Required for merge - PR checks must pass before merge.

### Release C# WSUS Manager

**File:** `.github/workflows/release-csharp.yml`

**Purpose:** Create GitHub release when version tag is pushed.

**Triggers:**
- Git tag push matching `v*.*.*` pattern (e.g., `v4.4.0`)

**Steps:**
1. **Checkout** - Clone repository
2. **Setup .NET** - Install .NET 8 SDK
3. **Restore** - Restore NuGet packages
4. **Build** - Build solution in Release configuration
5. **Test** - Run xUnit tests
6. **Publish** - Publish single-file EXE (win-x64)
7. **Zip** - Package EXE into distribution archive
8. **Create release** - Create GitHub release with tag
9. **Upload asset** - Upload EXE ZIP as release asset

**Output:**
- GitHub release published at https://github.com/anthonyscry/GA-WsusManager/releases
- Release notes from CHANGELOG.md (or auto-generated if not found)
- EXE asset attached to release

**Status:** Automatic - runs immediately after tag push.

### Build PowerShell GUI (Legacy)

**File:** `.github/workflows/build-powershell.yml`

**Purpose:** Build legacy PowerShell GUI (maintained but superseded by C# version).

**Triggers:**
- Push to `main` branch
- Pull request to `main` branch

**Steps:**
1. **Checkout** - Clone repository
2. **Setup PowerShell** - Install PowerShell 7
3. **Install PS2EXE** - Install PS2EXE module
4. **Run tests** - Invoke-Pester on Tests/ directory
5. **Code review** - Run PSScriptAnalyzer
6. **Build** - Compile PowerShell GUI to EXE
7. **Upload artifacts** - Save EXE

**Artifacts:**
- `WsusManager-PS-EXE` - PowerShell-compiled EXE

**Status:** Maintained for backward compatibility. New development focuses on C# version.

## CI/CD Pipeline Stages

### Stage 1: Build

```yaml
- name: Build
  run: dotnet build --configuration Release --no-restore
```

**Purpose:** Compile C# code into assemblies.

**Success criteria:** Zero compiler warnings (enforced by TreatWarningsAsErrors).

**Common failures:**
- CA2007 (ConfigureAwait) - Missing ConfigureAwait(false) in library code
- CS0169 (Unused field) - Private field never used
- CS0067 (Unused event) - Event never raised

### Stage 2: Test

```yaml
- name: Test
  run: dotnet test --no-build --configuration Release --logger "trx;LogFileName=test-results.trx" --collect:"XPlat Code Coverage" -- DataCollectionRunSettings.DataCollectors.DataCollector.Configuration.Format=opencover
```

**Purpose:** Run xUnit tests and collect code coverage.

**Success criteria:** All tests pass, no test failures.

**Common failures:**
- SQL not available - Database tests require SQL Express
- WinRM not enabled - Client management tests require WinRM
- Assert failures - Code changes broke existing tests

### Stage 3: Publish

```yaml
- name: Publish
  run: dotnet publish src/WsusManager.App/WsusManager.App.csproj --configuration Release --runtime win-x64 --self-contained true --output publish /p:PublishSingleFile=true
```

**Purpose:** Create single-file EXE distribution.

**Output:** `WsusManager.exe` (~15-20 MB) with embedded .NET runtime.

**Common failures:**
- Missing runtime - .NET 8 SDK not installed
- Platform mismatch - Trying to publish for wrong platform
- Dependency issues - NuGet package restore failed

## Artifacts

### Test Results (`test-results`)

**Format:** xUnit TRX (Visual Studio Test Results)

**Contents:** All test results with pass/fail status and error messages.

**Use:** View test results in GitHub Actions UI or download for detailed analysis.

**Download:** Actions → Workflow run → Artifacts → `test-results`

### Coverage Report (`coverage-report`)

**Format:** HTML report generated by ReportGenerator

**Contents:** Line coverage, branch coverage, coverage by assembly/class/method.

**Use:** Identify untested code, track coverage trends.

**Download:** Actions → Workflow run → Artifacts → `coverage-report`

**View:** Open `index.html` in browser after extracting.

### WsusManager EXE (`wsusmanager-exe`)

**Format:** ZIP archive containing `WsusManager.exe`

**Contents:** Single-file EXE with embedded .NET runtime, ready to run.

**Use:** Distribute to users, deploy to servers.

**Download:** Actions → Workflow run → Artifacts → `wsusmanager-exe`

## Running Workflows Locally

Before pushing, run the same commands CI executes:

```bash
# Build (Release configuration)
cd src
dotnet restore
dotnet build --configuration Release

# Run tests
dotnet test --no-build --configuration Release

# Run tests with coverage
dotnet test --no-build --configuration Release --collect:"XPlat Code Coverage"

# Publish single-file EXE
dotnet publish src/WsusManager.App/WsusManager.App.csproj \
  --configuration Release \
  --runtime win-x64 \
  --self-contained true \
  --output publish \
  -p:PublishSingleFile=true
```

## Troubleshooting

### "Build failed with warnings"

**Cause:** Compiler warnings treated as errors (TreatWarningsAsErrors).

**Solution:**
1. Check build log for specific warning
2. Fix warning in code (or add justification to suppress)
3. Rebuild to verify fix

**Common warnings:**
- `CA2007` - Add `.ConfigureAwait(false)` to async call
- `CS0169` - Remove unused field or mark with `#pragma warning disable`
- `CS0067` - Remove unused event

### "Tests failed"

**Cause:** One or more unit tests failed.

**Solution:**
1. Download `test-results` artifact
2. Open in Visual Studio or text editor
3. Find failed test and error message
4. Fix code or test (test may be wrong)

**Common test failures:**
- SQL connection failed - Ensure SQL Express running
- Assert.AreEqual failed - Code behavior changed
- Null reference exception - Missing null check

### "Coverage not generated"

**Cause:** Coverlet not collecting coverage or ReportGenerator not running.

**Solution:**
1. Verify `--collect:"XPlat Code Coverage"` in test command
2. Verify `coverage.cobertura.xml` exists after test run
3. Run ReportGenerator manually to generate HTML

### "EXE not created"

**Cause:** Publish step failed or wrong output path.

**Solution:**
1. Check publish command for syntax errors
2. Verify `win-x64` runtime is valid
3. Check output path (should be `publish/` directory)

### "Release not created"

**Cause:** Tag format wrong or release workflow failed.

**Solution:**
1. Verify tag format: `v*.*.*` (e.g., `v4.4.0`)
2. Check release workflow logs for errors
3. Manually create release if workflow fails (upload EXE from artifacts)

## Best Practices

### Before Pushing

1. **Build locally:** `dotnet build --configuration Release`
2. **Run tests:** `dotnet test --configuration Release`
3. **Check warnings:** Fix all compiler warnings
4. **Format code:** `dotnet format` (optional, auto-formats)

### After Merge

1. **Check artifacts:** Download and verify EXE works
2. **Review coverage:** Check coverage report for gaps
3. **Tag release:** Create git tag when ready to release

### Release Process

1. Update version in `src/WsusManager.App/WsusManager.App.csproj`
2. Update `CHANGELOG.md` with release notes
3. Commit and push to main
4. Create tag: `git tag v4.4.0 && git push origin v4.4.0`
5. Release workflow creates GitHub release automatically

## Permissions

**Required for CI/CD:**
- `actions:read` - View workflow runs
- `actions:write` - Cancel/workflows (administrators only)
- `contents:read` - Checkout repository
- `contents:write` - Create releases (administrators only)

**Secrets (if needed):**
- None currently (public repository, no external services)

## Future Enhancements

- [ ] Automated deployment to internal server
- [ ] Slack/email notifications on release
- [ ] Scheduled nightly builds
- [ ] Performance regression detection
- [ ] Dependency scanning (Dependabot)

## Related Documentation

- **[CONTRIBUTING.md](../CONTRIBUTING.md)** - Contribution guidelines and local development
- **[docs/releases.md](releases.md)** - Release process and versioning
- **[README.md](../README.md)** - Build instructions and project overview

---

*Last updated: 2026-02-21*
*For questions, open a GitHub Discussion or Issue.*
```

### Step 2: Update CONTRIBUTING.md

**File:** `CONTRIBUTING.md`
**Section:** "CI/CD Pipeline" (existing)

**Change:** Replace brief CI/CD section with reference to detailed doc:

```markdown
## CI/CD Pipeline

WSUS Manager uses GitHub Actions for continuous integration and deployment.

For detailed workflow documentation, troubleshooting guides, and artifact descriptions, see:
- **[docs/ci-cd.md](docs/ci-cd.md)** - Complete CI/CD pipeline documentation

**Quick summary:**
- **Build C# WSUS Manager** - Runs on push/PR to main (build, test, publish)
- **Release C# WSUS Manager** - Runs on git tag push (creates GitHub release)
- **Artifacts:** Test results, coverage report, single-file EXE
```

### Step 3: Create Workflow Diagram Image (Optional)

**File:** `docs/diagrams/ci-cd-flow.svg` or `.png`

**Tool:** Draw.io, Mermaid, or similar

**Content:** Visual representation of workflow:

```
┌─────────┐     ┌─────────┐     ┌─────────┐     ┌──────────┐
│  Push   │────▶│  Build  │────▶│  Test   │────▶│ Publish  │
│ to main │     │         │     │         │     │          │
└─────────┘     └─────────┘     └─────────┘     └──────────┘
                      │               │               │
                      ▼               ▼               ▼
                 ┌─────────┐     ┌─────────┐     ┌──────────┐
                 │ Artifacts│     │ Coverage │     │  EXE     │
                 └─────────┘     └─────────┘     └──────────┘
```

**Note:** Optional for v4.4 - text-based diagram in docs/ci-cd.md is sufficient.

### Step 4: Add to README.md (Optional)

**File:** `README.md`
**Section:** "Documentation"

**Add link:**
```markdown
## Documentation

- **[CLAUDE.md](CLAUDE.md)** - Development documentation (legacy PowerShell info)
- **[CONTRIBUTING.md](CONTRIBUTING.md)** - Contribution guidelines, build instructions, code style
- **[docs/ci-cd.md](docs/ci-cd.md)** - CI/CD pipeline documentation
```

## Dependencies

- **GitHub Actions workflows:** Must exist and be working
- **Artifacts:** Must be producing expected outputs
- **CONTRIBUTING.md:** Must exist (for cross-reference)

## Verification

**Manual verification steps:**
1. Read `docs/ci-cd.md` without referencing YAML files
2. Verify all workflows are documented
3. Verify troubleshooting guide covers common issues
4. Verify workflow diagram is accurate (if created)
5. Verify all links resolve (no broken file paths)

**Acceptance criteria:**
- [ ] CI/CD documentation file created
- [ ] All 3 workflows documented with purpose, triggers, outputs
- [ ] Workflow diagram shows pipeline flow
- [ ] Troubleshooting guide covers at least 5 common issues
- [ ] CONTRIBUTING.md references detailed doc
- [ ] README.md includes link (optional)
- [ ] No broken links

## Notes

- Keep workflow descriptions accurate - update YAML files if docs change (or vice versa)
- Don't duplicate YAML content - explain "what and why", not just restate YAML
- Troubleshooting should be practical - real issues contributors encounter
- Workflow diagram can be simple - ASCII art is fine for v4.4
- Document secrets if added in future (currently none)

---

*Plan: 24-04-PLAN.md*
*Phase: 24-documentation-generation*
*Created: 2026-02-21*

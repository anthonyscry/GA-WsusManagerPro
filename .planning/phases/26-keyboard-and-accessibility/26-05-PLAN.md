---
phase: 26-keyboard-and-accessibility
plan: 05
type: execute
wave: 1
depends_on: []
files_modified:
  - src/WsusManager.App/Views/MainWindow.xaml
  - src/WsusManager.App/Views/SettingsDialog.xaml
  - src/WsusManager.App/Views/SyncProfileDialog.xaml
  - src/WsusManager.App/Views/TransferDialog.xaml
  - src/WsusManager.App/Views/ScheduleTaskDialog.xaml
  - src/WsusManager.App/Views/InstallDialog.xaml
autonomous: false
requirements:
  - UX-02

must_haves:
  truths:
    - "User can navigate all interactive elements using Tab key"
    - "Tab order follows visual layout (left-to-right, top-to-bottom)"
    - "Arrow keys work within lists and comboboxes"
    - "Enter/Space activates focused button or checkbox"
    - "Focus visible on all controls (WPF default focus rectangle)"
  artifacts:
    - path: "src/WsusManager.App/Views/MainWindow.xaml"
      provides: "Logical TabIndex for navigation elements"
      contains: "KeyboardNavigation.*TabNavigation|TabIndex"
    - path: "src/WsusManager.App/Views/SettingsDialog.xaml"
      provides: "Logical tab order for dialog controls"
      contains: "KeyboardNavigation.*DirectionNavigation|TabIndex"
  key_links:
    - from: "Keyboard navigation"
      to: "WPF KeyboardNavigation class"
      via: "Attached properties on containers"
      pattern: "KeyboardNavigation\\..*=\".*\""
---

<objective>
Implement full keyboard navigation support using Tab, arrow keys, Enter, and Space for complete keyboard-only operation.

Purpose: Users with mobility impairments or those who prefer keyboard workflows should be able to operate the entire application without a mouse. WPF has built-in keyboard navigation; this plan ensures proper tab order and no navigation traps.
Output: Logical tab order, arrow key navigation in lists, Enter/Space activation works everywhere.
</objective>

<execution_context>
@/home/anthonyscry/.claude/get-shit-done/workflows/execute-plan.md
@/home/anthonyscry/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/26-keyboard-and-accessibility/26-CONTEXT.md

@src/WsusManager.App/Views/MainWindow.xaml
@src/WsusManager.App/Views/SettingsDialog.xaml
@src/WsusManager.App/Views/SyncProfileDialog.xaml
@src/WsusManager.App/Views/TransferDialog.xaml
@src/WsusManager.App/Views/ScheduleTaskDialog.xaml
@src/WsusManager.App/Views/InstallDialog.xaml
</context>

<tasks>

<task type="auto">
  <name>Set KeyboardNavigation mode on layout containers</name>
  <files>
    src/WsusManager.App/Views/MainWindow.xaml
    src/WsusManager.App/Views/SettingsDialog.xaml
    src/WsusManager.App/Views/SyncProfileDialog.xaml
    src/WsusManager.App/Views/TransferDialog.xaml
    src/WsusManager.App/Views/ScheduleTaskDialog.xaml
    src/WsusManager.App/Views/InstallDialog.xaml
  </files>
  <action>
    Add KeyboardNavigation attached properties to top-level layout containers to ensure logical tab order.

    **MainWindow.xaml:**
    - On main Grid: `KeyboardNavigation.TabNavigation="Once"` (cycles through tab stops once, then moves to next container)
    - On sidebar Border: `KeyboardNavigation.TabNavigation="Continue"` (default, sequential)
    - On main content Grid: `KeyboardNavigation.TabNavigation="Continue"`
    - On each panel (Dashboard, Diagnostics, ClientTools, Database): `KeyboardNavigation.TabNavigation="Once"` to prevent tab getting stuck in hidden panels

    **Dialog XAML files:**
    - On root Grid/StackPanel: `KeyboardNavigation.TabNavigation="Continue"` (sequential through all controls)
    - On list/combobox containers: `KeyboardNavigation.DirectionalNavigation="Cycle"` (arrow keys wrap within list)

    Example syntax:
    ```xml
    <Grid KeyboardNavigation.TabNavigation="Once">
        <Button Content="First"/>
        <Button Content="Second"/>
    </Grid>
    ```

    Focus on containers that wrap multiple interactive controls. DO NOT add KeyboardNavigation to decorative elements (Border, TextBlock labels).
  </action>
  <verify>Build passes: `dotnet build src/WsusManager.App/WsusManager.App.csproj --configuration Release`</verify>
  <done>All layout containers have appropriate KeyboardNavigation attached properties set</done>
</task>

<task type="auto">
  <name>Verify default WPF keyboard behaviors work</name>
  <files>Tests/WsusManager.App.Tests/KeyboardNavigationTests.cs</files>
  <action>
    Create a test that verifies XAML structure supports keyboard navigation. Create `Tests/WsusManager.App.Tests/KeyboardNavigationTests.cs`:

    ```csharp
    using Xunit;
    using System.IO;
    using System.Xml.Linq;

    namespace WsusManager.App.Tests;

    public class KeyboardNavigationTests
    {
        [Fact]
        public void MainWindow_ShouldHaveKeyboardNavigationAttributes()
        {
            var mainWindowXaml = Path.Combine("src", "WsusManager.App", "Views", "MainWindow.xaml");
            var content = File.ReadAllText(mainWindowXaml);

            // Verify KeyboardNavigation attributes are present
            Assert.Contains("KeyboardNavigation.", content);
        }

        [Theory]
        [InlineData("SettingsDialog.xaml")]
        [InlineData("SyncProfileDialog.xaml")]
        [InlineData("TransferDialog.xaml")]
        public void Dialogs_ShouldSupportTabNavigation(string dialogFile)
        {
            var dialogPath = Path.Combine("src", "WsusManager.App", "Views", dialogFile);
            var xaml = XDocument.Load(dialogPath);

            // Count interactive elements (Button, TextBox, ComboBox, CheckBox, RadioButton)
            var interactiveElements = xaml.Descendants()
                .Where(e => e.Name.LocalName is "Button" or "TextBox" or "ComboBox" or "CheckBox" or "RadioButton" or "ListBox")
                .ToList();

            // Verify dialog has interactive elements (sanity check)
            Assert.True(interactiveElements.Count > 0, $"{dialogFile} should have interactive elements");
        }

        [Fact]
        public void MainWindow_ShouldNotContainIsTabStopFalse()
        {
            // Verify no elements explicitly disable tab navigation
            var mainWindowXaml = Path.Combine("src", "WsusManager.App", "Views", "MainWindow.xaml");
            var content = File.ReadAllText(mainWindowXaml);

            Assert.DoesNotContain("IsTabStop=\"False\"", content);
            Assert.DoesNotContain("IsTabStop=\"false\"", content);
        }
    }
    ```

    This is a structural test (full keyboard navigation testing requires UI automation).
  </action>
  <verify>Run tests: `dotnet test Tests/WsusManager.App.Tests/WsusManager.App.Tests.csproj --filter "FullyQualifiedName~KeyboardNavigationTests"` passes</verify>
  <done>KeyboardNavigationTests.cs created with structural verification of keyboard navigation support</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Keyboard navigation infrastructure with KeyboardNavigation attributes on all layout containers</what-built>
  <how-to-verify>
    Manual keyboard navigation test:
    1. Build and run the application: `dotnet run --project src/WsusManager.App/WsusManager.App.csproj --configuration Release`
    2. Press Tab repeatedly - focus should move through sidebar buttons, then main content, then back to sidebar
    3. Press Shift+Tab - focus should move backward through tab order
    4. Navigate to Dashboard panel (if not already there), press Tab to reach Computers list
    5. Press up/down arrows - selection should move within the list
    6. Navigate to any button, press Enter - button should activate
    7. Press Ctrl+S - Settings dialog should open
    8. In Settings dialog, press Tab - focus should move through controls sequentially
    9. Focus ComboBox, press up/down arrows - options should cycle
    10. Press Escape - dialog should close
    11. Press Ctrl+Q - quit confirmation should appear
    12. Verify focus is visible (default WPF focus rectangle or dotted border)

    Expected results:
    - Tab moves focus through all interactive elements
    - Arrow keys work within lists/comboboxes
    - Enter activates focused buttons
    - No keyboard traps (focus never gets stuck)
    - Focus indicator is visible
  </how-to-verify>
  <resume-signal>Type "approved" if all keyboard navigation works correctly, or describe specific issues (e.g., "Tab order is wrong in sidebar", "Arrow keys don't work in Computers list")</resume-signal>
</task>

</tasks>

<verification>
Overall phase checks:
1. Build succeeds: `dotnet build src/WsusManager.App/WsusManager.App.csproj --configuration Release`
2. All tests pass: `dotnet test Tests/WsusManager.App.Tests/WsusManager.App.Tests.csproj`
3. Human verification confirms keyboard navigation works throughout the application
</verification>

<success_criteria>
1. Tab key navigates through all interactive elements in logical order
2. Shift+Tab navigates backward
3. Arrow keys work within lists and comboboxes
4. Enter/Space activates focused button
5. Escape closes dialogs or cancels operations
6. Focus indicator is visible on all controls
</success_criteria>

<output>
After completion, create `.planning/phases/26-keyboard-and-accessibility/26-05-SUMMARY.md`
</output>

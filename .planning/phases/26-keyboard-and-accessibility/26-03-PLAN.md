---
phase: 26-keyboard-and-accessibility
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - src/WsusManager.App/Views/MainWindow.xaml
  - src/WsusManager.App/Views/SettingsDialog.xaml
  - src/WsusManager.App/Views/SyncProfileDialog.xaml
  - src/WsusManager.App/Views/TransferDialog.xaml
  - src/WsusManager.App/Views/ScheduleTaskDialog.xaml
  - src/WsusManager.App/Views/InstallDialog.xaml
autonomous: true
requirements:
  - UX-05

must_haves:
  truths:
    - "Dialog windows center on owner window when opened"
    - "Standalone dialogs (no owner) center on primary screen"
    - "Dialog WindowStartupLocation is set correctly"
  artifacts:
    - path: "src/WsusManager.App/Views/SettingsDialog.xaml"
      provides: "Dialog with proper centering behavior"
      contains: "WindowStartupLocation=\"CenterOwner\""
    - path: "src/WsusManager.App/Views/SyncProfileDialog.xaml"
      provides: "Dialog with proper centering behavior"
      contains: "WindowStartupLocation="
    - path: "src/WsusManager.App/ViewModels/MainViewModel.cs"
      provides: "Dialog opening code that passes owner window"
      contains: "new.*Dialog.*Owner"
  key_links:
    - from: "MainViewModel dialog opening methods"
      to: "Dialog Window.Owner property"
      via: "dialog.Owner = ownerWindow"
      pattern: "\.Owner\s*=.*Window"
---

<objective>
Ensure all dialog windows center properly on their owner window or primary screen.

Purpose: Dialogs that appear in random screen positions or off-screen create poor UX. Proper centering improves usability and accessibility by keeping dialog context visible.
Output: All modal dialogs center on MainWindow; standalone dialogs (if any) center on primary screen.
</objective>

<execution_context>
@/home/anthonyscry/.claude/get-shit-done/workflows/execute-plan.md
@/home/anthonyscry/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/26-keyboard-and-accessibility/26-CONTEXT.md

@src/WsusManager.App/Views/MainWindow.xaml
@src/WsusManager.App/Views/SettingsDialog.xaml
@src/WsusManager.App/Views/SyncProfileDialog.xaml
@src/WsusManager.App/Views/TransferDialog.xaml
@src/WsusManager.App/Views/ScheduleTaskDialog.xaml
@src/WsusManager.App/Views/InstallDialog.xaml
@src/WsusManager.App/Views/GpoInstructionsDialog.xaml
@src/WsusManager.App/ViewModels/MainViewModel.cs
</context>

<tasks>

<task type="auto">
  <name>Set WindowStartupLocation on all dialog XAML files</name>
  <files>
    src/WsusManager.App/Views/SettingsDialog.xaml
    src/WsusManager.App/Views/SyncProfileDialog.xaml
    src/WsusManager.App/Views/TransferDialog.xaml
    src/WsusManager.App/Views/ScheduleTaskDialog.xaml
    src/WsusManager.App/Views/InstallDialog.xaml
    src/WsusManager.App/Views/GpoInstructionsDialog.xaml
  </files>
  <action>
    For each dialog XAML file, verify or add `WindowStartupLocation="CenterOwner"` attribute on the root Window element.

    Check each dialog file:
    1. SettingsDialog.xaml
    2. SyncProfileDialog.xaml
    3. TransferDialog.xaml
    4. ScheduleTaskDialog.xaml
    5. InstallDialog.xaml
    6. GpoInstructionsDialog.xaml

    If any dialog uses `WindowStartupLocation="CenterScreen"` and has an owner, change it to `CenterOwner`.

    If any dialog does NOT have WindowStartupLocation attribute, add `WindowStartupLocation="CenterOwner"`.

    Example (SettingsDialog.xaml):
    ```xml
    <Window x:Class="WsusManager.App.Views.SettingsDialog"
            xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
            xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
            Title="Settings"
            Width="500" Height="580"
            WindowStartupLocation="CenterOwner"
            ResizeMode="CanResize">
    ```

    All dialogs in this application should be owned by MainWindow, so CenterOwner is the correct setting.
  </action>
  <verify>Build passes: `dotnet build src/WsusManager.App/WsusManager.App.csproj --configuration Release`</verify>
  <done>All 6 dialog XAML files have WindowStartupLocation="CenterOwner" set</done>
</task>

<task type="auto">
  <name>Verify MainViewModel passes owner window to dialogs</name>
  <files>src/WsusManager.App/ViewModels/MainViewModel.cs</files>
  <action>
    Search MainViewModel.cs for all dialog instantiation code. Each dialog should be opened with an owner window set.

    Look for patterns like:
    ```csharp
    var dialog = new SettingsDialog();
    dialog.Owner = Application.Current.MainWindow;
    dialog.ShowDialog();
    ```

    Verify the following methods pass owner window correctly:
    1. OpenSettings() - Settings dialog
    2. ShowHelp() - Help/About dialog
    3. RunTransferCommand - Transfer dialog
    4. RunOnlineSyncCommand - Sync profile dialog (via ShowSyncProfileDialog helper)
    5. RunScheduleTaskCommand - Schedule task dialog
    6. RunInstallWsusCommand - Install dialog
    7. RunCreateGpoCommand - GPO instructions dialog

    For any dialog missing `dialog.Owner = Application.Current.MainWindow;`, add it before `ShowDialog()` call.

    If dialogs are opened via helper methods in separate classes (e.g., DialogHelper), verify those helpers accept and set Owner parameter.

    DO NOT change non-dialog windows or windows that intentionally don't have an owner.
  </action>
  <verify>
    1. Build passes: `dotnet build src/WsusManager.App/WsusManager.App.csproj --configuration Release`
    2. Grep for dialog owner: `grep -n "\.Owner\s*=" src/WsusManager.App/ViewModels/MainViewModel.cs` shows at least 6 matches (one per dialog type)
  </verify>
  <done>All dialog instantiation code in MainViewModel.cs sets dialog.Owner = Application.Current.MainWindow before ShowDialog()</done>
</task>

<task type="auto">
  <name>Add dialog centering verification test</name>
  <files>Tests/WsusManager.App.Tests/DialogCenteringTests.cs</files>
  <action>
    Create a test that verifies dialog XAML files have proper WindowStartupLocation set. Create `Tests/WsusManager.App.Tests/DialogCenteringTests.cs`:

    ```csharp
    using Xunit;
    using System.IO;
    using System.Linq;

    namespace WsusManager.App.Tests;

    public class DialogCenteringTests
    {
        [Theory]
        [InlineData("SettingsDialog.xaml")]
        [InlineData("SyncProfileDialog.xaml")]
        [InlineData("TransferDialog.xaml")]
        [InlineData("ScheduleTaskDialog.xaml")]
        [InlineData("InstallDialog.xaml")]
        [InlineData("GpoInstructionsDialog.xaml")]
        public void Dialog_ShouldUseCenterOwnerStartupLocation(string filename)
        {
            var dialogPath = Path.Combine("src", "WsusManager.App", "Views", filename);
            var xamlContent = File.ReadAllText(dialogPath);

            Assert.Contains("WindowStartupLocation=\"CenterOwner\"", xamlContent);
            // Verify CenterScreen is NOT used (dialogs should be owned)
            Assert.DoesNotContain("WindowStartupLocation=\"CenterScreen\"", xamlContent);
        }

        [Fact]
        public void MainWindow_ShouldUseCenterScreenStartupLocation()
        {
            var mainWindowPath = Path.Combine("src", "WsusManager.App", "Views", "MainWindow.xaml");
            var xamlContent = File.ReadAllText(mainWindowPath);

            // Main window should center on screen, not an owner (it has no owner)
            Assert.Contains("WindowStartupLocation=\"CenterScreen\"", xamlContent);
        }
    }
    ```
  </action>
  <verify>Run tests: `dotnet test Tests/WsusManager.App.Tests/WsusManager.App.Tests.csproj --filter "FullyQualifiedName~DialogCenteringTests"` passes</verify>
  <done>DialogCenteringTests.cs created with tests verifying all dialogs use CenterOwner and MainWindow uses CenterScreen</done>
</task>

</tasks>

<verification>
Overall phase checks:
1. Build succeeds: `dotnet build src/WsusManager.App/WsusManager.App.csproj --configuration Release`
2. All tests pass: `dotnet test Tests/WsusManager.App.Tests/WsusManager.App.Tests.csproj`
3. Manual verification: Run application and open each dialog - they should appear centered on MainWindow
</verification>

<success_criteria>
1. All 6 dialog XAML files have WindowStartupLocation="CenterOwner"
2. MainViewModel.cs sets dialog.Owner for all dialog instances
3. MainWindow.xaml has WindowStartupLocation="CenterScreen"
4. Opening any dialog shows it centered on MainWindow
</success_criteria>

<output>
After completion, create `.planning/phases/26-keyboard-and-accessibility/26-03-SUMMARY.md`
</output>

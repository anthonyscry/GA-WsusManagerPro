---
phase: 26-keyboard-and-accessibility
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/WsusManager.App/Views/MainWindow.xaml
  - src/WsusManager.App/ViewModels/MainViewModel.cs
autonomous: true
requirements:
  - UX-01

must_haves:
  truths:
    - "Pressing F1 opens Help/About dialog"
    - "Pressing F5 refreshes dashboard data"
    - "Pressing Ctrl+S opens Settings dialog"
    - "Pressing Ctrl+Q prompts to quit application"
    - "Pressing Escape closes current dialog or cancels operation"
  artifacts:
    - path: "src/WsusManager.App/Views/MainWindow.xaml"
      provides: "InputBindings for global keyboard shortcuts"
      contains: "Window.InputBindings"
    - path: "src/WsusManager.App/ViewModels/MainViewModel.cs"
      provides: "ICommand properties for keyboard shortcut routing"
      exports: ["ShowHelpCommand", "RefreshDashboardCommand", "OpenSettingsCommand", "QuitCommand"]
  key_links:
    - from: "MainWindow.xaml InputBindings"
      to: "MainViewModel Commands"
      via: "KeyBinding element with Command binding"
      pattern: "KeyBinding.*Key=\"F1\".*Command=\"{Binding ShowHelpCommand}\""
---

<objective>
Implement global keyboard shortcuts for common operations (F1, F5, Ctrl+S, Ctrl+Q, Escape) to enable power-user workflows and accessibility compliance.

Purpose: Keyboard shortcuts are standard Windows UI expectations (F1 for Help, F5 for Refresh) and improve accessibility for users who cannot use pointing devices.
Output: Working global shortcuts that trigger the same operations as menu/button clicks.
</objective>

<execution_context>
@/home/anthonyscry/.claude/get-shit-done/workflows/execute-plan.md
@/home/anthonyscry/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/26-keyboard-and-accessibility/26-CONTEXT.md

@src/WsusManager.App/Views/MainWindow.xaml
@src/WsusManager.App/ViewModels/MainViewModel.cs
@src/WsusManager.Core/Services/Interfaces/IDashboardService.cs
</context>

<tasks>

<task type="auto">
  <name>Add InputBindings section to MainWindow.xaml</name>
  <files>src/WsusManager.App/Views/MainWindow.xaml</files>
  <action>
    In MainWindow.xaml, add a Window.InputBindings section immediately after the Window opening tag, containing 5 KeyBinding elements:

    1. F1 → ShowHelpCommand
    2. F5 → RefreshDashboardCommand
    3. Ctrl+S → OpenSettingsCommand
    4. Ctrl+Q → QuitCommand
    5. Escape → CancelOperationCommand

    Format:
    ```xml
    <Window.InputBindings>
        <KeyBinding Key="F1" Command="{Binding ShowHelpCommand}"/>
        <KeyBinding Key="F5" Command="{Binding RefreshDashboardCommand}"/>
        <KeyBinding Key="S" Modifiers="Control" Command="{Binding OpenSettingsCommand}"/>
        <KeyBinding Key="Q" Modifiers="Control" Command="{Binding QuitCommand}"/>
        <KeyBinding Key="Escape" Command="{Binding CancelOperationCommand}"/>
    </Window.InputBindings>
    ```

    DO NOT add input binding for navigation keys (Tab, arrows) - those are handled by WPF's built-in keyboard navigation system.
  </action>
  <verify>Build passes: `dotnet build src/WsusManager.App/WsusManager.App.csproj --configuration Release` returns 0 errors</verify>
  <done>MainWindow.xaml contains Window.InputBindings section with 5 KeyBinding elements bound to ViewModel commands</done>
</task>

<task type="auto">
  <name>Add keyboard shortcut ICommand properties to MainViewModel</name>
  <files>src/WsusManager.App/ViewModels/MainViewModel.cs</files>
  <action>
    Add 5 new [RelayCommand] partial methods to MainViewModel.cs after the existing Navigate command (around line 150):

    1. **ShowHelpCommand**: Calls Navigate("Help") to open Help dialog
    2. **RefreshDashboardCommand**: Calls RefreshDashboardAsync() - creates this async method if it doesn't exist (should call UpdateDashboardAsync and set StatusMessage = "Dashboard refreshed")
    3. **OpenSettingsCommand**: Calls OpenSettings() - wraps the existing _ = OpenSettings(); call in a RelayCommand
    4. **QuitCommand**: Shows confirmation MessageBox("Are you sure you want to quit?", "Confirm Quit", MessageBoxButton.YesNo) and calls Application.Current.Shutdown() if Yes; if IsOperationRunning is true, show MessageBox("Cannot quit while operation is running.", "Cannot Quit", MessageBoxButton.OK) instead
    5. **CancelOperationCommand**: Calls CancelCurrentOperation() if IsOperationRunning is true (use _operationCts?.Cancel(); IsOperationRunning = false; StatusMessage = "Operation cancelled";)

    Use [RelayCommand] attribute on private partial void methods following the existing pattern in the file.
  </action>
  <verify>Build passes: `dotnet build src/WsusManager.App/WsusManager.App.csproj --configuration Release` returns 0 errors, 0 warnings</verify>
  <done>MainViewModel.cs has 5 new [RelayCommand] methods (ShowHelpCommand, RefreshDashboardCommand, OpenSettingsCommand, QuitCommand, CancelOperationCommand) with proper implementations</done>
</task>

<task type="auto">
  <name>Create manual test for keyboard shortcuts</name>
  <files>Tests/WsusManager.App.Tests/KeyboardShortcutsTests.cs</files>
  <action>
    Create a new unit test file `Tests/WsusManager.App.Tests/KeyboardShortcutsTests.cs` with a single test:

    ```csharp
    using CommunityToolkit.Mvvm.Input;
    using Xunit;

    namespace WsusManager.App.Tests;

    public class KeyboardShortcutsTests
    {
        [Fact]
        public void MainViewModel_ShouldHaveAllKeyboardShortcutCommands()
        {
            // Arrange & Act - get command types via reflection
            var viewModelType = typeof(MainViewModel);
            var commandProperties = viewModelType.GetProperties()
                .Where(p => p.PropertyType == typeof(ICommand) && p.Name.EndsWith("Command"))
                .Select(p => p.Name)
                .ToList();

            // Assert - verify all expected commands exist
            Assert.Contains("ShowHelpCommand", commandProperties);
            Assert.Contains("RefreshDashboardCommand", commandProperties);
            Assert.Contains("OpenSettingsCommand", commandProperties);
            Assert.Contains("QuitCommand", commandProperties);
            Assert.Contains("CancelOperationCommand", commandProperties);
        }
    }
    ```

    This test verifies the commands exist (full functional testing requires manual UI testing).
  </action>
  <verify>Run tests: `dotnet test Tests/WsusManager.App.Tests/WsusManager.App.Tests.csproj --filter "FullyQualifiedName~KeyboardShortcutsTests"` passes</verify>
  <done>KeyboardShortcutsTests.cs created with test verifying all 5 shortcut commands exist on MainViewModel</done>
</task>

</tasks>

<verification>
Overall phase checks:
1. Build succeeds: `dotnet build src/WsusManager.App/WsusManager.App.csproj --configuration Release`
2. All tests pass: `dotnet test Tests/WsusManager.App.Tests/WsusManager.App.Tests.csproj`
3. Manual verification: Run application and test F1, F5, Ctrl+S, Ctrl+Q, Escape keys (document results in SUMMARY.md)
</verification>

<success_criteria>
1. Pressing F1 opens Help dialog (same as clicking Help button)
2. Pressing F5 refreshes dashboard data (re-queries health/service status)
3. Pressing Ctrl+S opens Settings dialog
4. Pressing Ctrl+Q shows confirmation and quits (or blocks if operation running)
5. Pressing Escape cancels current operation or closes dialog
</success_criteria>

<output>
After completion, create `.planning/phases/26-keyboard-and-accessibility/26-01-SUMMARY.md`
</output>

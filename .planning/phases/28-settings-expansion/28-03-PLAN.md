---
phase: 28-settings-expansion
plan: 03
type: execute
wave: 1
depends_on: ["28-01", "28-02"]
files_modified:
  - src/WsusManager.App/Views/SettingsDialog.xaml
autonomous: true
requirements:
  - UX-06

must_haves:
  truths:
    - "SettingsDialog has 4 GroupBox sections: Operations, Logging, Behavior, Advanced"
    - "Each setting has appropriate control type (ComboBox, TextBox, CheckBox)"
    - "Two-column layout used for compact form (label | control)"
    - "All controls have ToolTips for additional context"
    - "Reset to Defaults button in Advanced section"
    - "ScrollViewer wrapper if content exceeds window height"
  artifacts:
    - path: "src/WsusManager.App/Views/SettingsDialog.xaml"
      provides: "Redesigned settings dialog with all 8 settings"
      contains: "4 GroupBox sections, 8 settings controls, Reset button"
  key_links:
    - from: "SettingsDialog.xaml"
      to: "AppSettings properties"
      via: "data binding and element names"
      pattern: "XAML bindings"
---

<objective>
Redesign SettingsDialog.xaml with 4 sections for Operations, Logging, Behavior, and Advanced settings. Add all 8 new controls with proper layout, tooltips, and validation support.

Purpose: Settings dialog needs to display 8 new settings in an organized, user-friendly layout. GroupBox sections provide clear categorization. Two-column layout saves vertical space. ToolTips provide helpful context.

Output: SettingsDialog.xaml redesigned with 4 GroupBox sections, all controls bound to AppSettings properties.
</objective>

<execution_context>
@/home/anthonyscry/.claude/get-shit-done/workflows/execute-plan.md
@/home/anthonyscry/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/STATE.md
@.planning/phases/28-settings-expansion/28-CONTEXT.md
@src/WsusManager.App/Views/SettingsDialog.xaml
@src/WsusManager.Core/Models/AppSettings.cs
</context>

<tasks>

<task type="auto">
  <name>Add Operations section with Default Sync Profile</name>
  <files>src/WsusManager.App/Views/SettingsDialog.xaml</files>
  <action>
    Update SettingsDialog.xaml to add an Operations GroupBox section:

    1. Add after the existing Server Mode section (or integrate if preferred)

    2. Create GroupBox with header "Operations" and ComboBox for Default Sync Profile:

    ```xml
    <!-- Section: Operations -->
    <GroupBox Grid.Row="2" Header="Operations" Margin="0,0,0,16">
        <GroupBox.HeaderTemplate>
            <DataTemplate>
                <TextBlock Text="{Binding}" FontWeight="SemiBold" FontSize="13"
                           Foreground="{DynamicResource TextSecondary}"/>
            </DataTemplate>
        </GroupBox.HeaderTemplate>
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="160"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <!-- Default Sync Profile -->
            <TextBlock Grid.Row="0" Grid.Column="0"
                       Text="Default Sync Profile"
                       Foreground="{DynamicResource TextSecondary}" FontSize="12"
                       VerticalAlignment="Center" Margin="0,0,0,12">
                <TextBlock.ToolTip>
                    <ToolTip Content="Preset selection when opening Online Sync dialog."/>
                </TextBlock.ToolTip>
            </TextBlock>
            <ComboBox x:Name="CboDefaultSyncProfile"
                      Grid.Row="0" Grid.Column="1"
                      automation:AutomationProperties.AutomationId="DefaultSyncProfileComboBox"
                      Background="{DynamicResource InputBackground}"
                      Foreground="{DynamicResource TextPrimary}"
                      BorderBrush="{DynamicResource BorderPrimary}"
                      Padding="6,4" FontSize="12" Margin="0,0,0,12"
                      KeyboardNavigation.DirectionalNavigation="Cycle">
                <ComboBoxItem Tag="Full">Full Sync</ComboBoxItem>
                <ComboBoxItem Tag="Quick">Quick Sync</ComboBoxItem>
                <ComboBoxItem Tag="SyncOnly">Sync Only</ComboBoxItem>
            </ComboBox>
        </Grid>
    </GroupBox>
    ```

    DO NOT: Remove existing sections - this is additive to the current layout
  </action>
  <verify>
    dotnet build src/WsusManager.App/WsusManager.App.csproj succeeds
  </verify>
  <done>
    Operations GroupBox added with Default Sync Profile ComboBox and ToolTip
  </done>
</task>

<task type="auto">
  <name>Add Logging section with 3 settings</name>
  <files>src/WsusManager.App/Views/SettingsDialog.xaml</files>
  <action>
    Add a Logging GroupBox section after Operations:

    ```xml
    <!-- Section: Logging -->
    <GroupBox Grid.Row="3" Header="Logging" Margin="0,0,0,16">
        <GroupBox.HeaderTemplate>
            <DataTemplate>
                <TextBlock Text="{Binding}" FontWeight="SemiBold" FontSize="13"
                           Foreground="{DynamicResource TextSecondary}"/>
            </DataTemplate>
        </GroupBox.HeaderTemplate>
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="160"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <!-- Log Level -->
            <TextBlock Grid.Row="0" Grid.Column="0"
                       Text="Log Level"
                       Foreground="{DynamicResource TextSecondary}" FontSize="12"
                       VerticalAlignment="Center" Margin="0,0,0,12">
                <TextBlock.ToolTip>
                    <ToolTip Content="Minimum log level to output (Debug = verbose, Fatal = critical only)."/>
                </TextBlock.ToolTip>
            </TextBlock>
            <ComboBox x:Name="CboLogLevel"
                      Grid.Row="0" Grid.Column="1"
                      automation:AutomationProperties.AutomationId="LogLevelComboBox"
                      Background="{DynamicResource InputBackground}"
                      Foreground="{DynamicResource TextPrimary}"
                      BorderBrush="{DynamicResource BorderPrimary}"
                      Padding="6,4" FontSize="12" Margin="0,0,0,12"
                      KeyboardNavigation.DirectionalNavigation="Cycle">
                <ComboBoxItem Tag="Debug">Debug</ComboBoxItem>
                <ComboBoxItem Tag="Info">Info</ComboBoxItem>
                <ComboBoxItem Tag="Warning">Warning</ComboBoxItem>
                <ComboBoxItem Tag="Error">Error</ComboBoxItem>
                <ComboBoxItem Tag="Fatal">Fatal</ComboBoxItem>
            </ComboBox>

            <!-- Retention Days -->
            <TextBlock Grid.Row="1" Grid.Column="0"
                       Text="Retention Days"
                       Foreground="{DynamicResource TextSecondary}" FontSize="12"
                       VerticalAlignment="Center" Margin="0,0,0,12">
                <TextBlock.ToolTip>
                    <ToolTip Content="Number of days to retain log files before deletion (1-365)."/>
                </TextBlock.ToolTip>
            </TextBlock>
            <TextBox x:Name="TxtLogRetentionDays"
                     Grid.Row="1" Grid.Column="1"
                     automation:AutomationProperties.AutomationId="LogRetentionDaysTextBox"
                     Background="{DynamicResource InputBackground}"
                     Foreground="{DynamicResource TextPrimary}"
                     BorderBrush="{DynamicResource BorderPrimary}"
                     Padding="6,4" FontSize="12" Margin="0,0,0,12"
                     InputScope="Number"/>

            <!-- Max File Size MB -->
            <TextBlock Grid.Row="2" Grid.Column="0"
                       Text="Max File Size (MB)"
                       Foreground="{DynamicResource TextSecondary}" FontSize="12"
                       VerticalAlignment="Center">
                <TextBlock.ToolTip>
                    <ToolTip Content="Maximum log file size in MB before rotation (1-1000)."/>
                </TextBlock.ToolTip>
            </TextBlock>
            <TextBox x:Name="TxtLogMaxFileSizeMb"
                     Grid.Row="2" Grid.Column="1"
                     automation:AutomationProperties.AutomationId="LogMaxFileSizeMbTextBox"
                     Background="{DynamicResource InputBackground}"
                     Foreground="{DynamicResource TextPrimary}"
                     BorderBrush="{DynamicResource BorderPrimary}"
                     Padding="6,4" FontSize="12"
                     InputScope="Number"/>
        </Grid>
    </GroupBox>
    ```

    DO NOT: Hardcode validation in XAML - validation is handled in code-behind
  </action>
  <verify>
    dotnet build src/WsusManager.App/WsusManager.App.csproj succeeds
  </verify>
  <done>
    Logging GroupBox added with Log Level ComboBox, Retention Days TextBox, Max File Size TextBox, all with ToolTips
  </done>
</task>

<task type="auto">
  <name>Add Behavior section with 3 settings</name>
  <files>src/WsusManager.App/Views/SettingsDialog.xaml</files>
  <action>
    Add a Behavior GroupBox section after Logging:

    ```xml
    <!-- Section: Behavior -->
    <GroupBox Grid.Row="4" Header="Behavior" Margin="0,0,0,16">
        <GroupBox.HeaderTemplate>
            <DataTemplate>
                <TextBlock Text="{Binding}" FontWeight="SemiBold" FontSize="13"
                           Foreground="{DynamicResource TextSecondary}"/>
            </DataTemplate>
        </GroupBox.HeaderTemplate>
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="160"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <!-- Persist Window State -->
            <TextBlock Grid.Row="0" Grid.Column="0"
                       Text="Persist Window State"
                       Foreground="{DynamicResource TextSecondary}" FontSize="12"
                       VerticalAlignment="Center" Margin="0,0,0,12">
                <TextBlock.ToolTip>
                    <ToolTip Content="Save and restore window position and size between sessions."/>
                </TextBlock.ToolTip>
            </TextBlock>
            <CheckBox x:Name="ChkPersistWindowState"
                      Grid.Row="0" Grid.Column="1"
                      automation:AutomationProperties.AutomationId="PersistWindowStateCheckBox"
                      Content="Save position and size"
                      VerticalAlignment="Center" Margin="0,0,0,12"/>

            <!-- Dashboard Refresh Interval -->
            <TextBlock Grid.Row="1" Grid.Column="0"
                       Text="Refresh Interval"
                       Foreground="{DynamicResource TextSecondary}" FontSize="12"
                       VerticalAlignment="Center" Margin="0,0,0,12">
                <TextBlock.ToolTip>
                    <ToolTip Content="How often to refresh dashboard data from WSUS server."/>
                </TextBlock.ToolTip>
            </TextBlock>
            <ComboBox x:Name="CboDashboardRefreshInterval"
                      Grid.Row="1" Grid.Column="1"
                      automation:AutomationProperties.AutomationId="DashboardRefreshIntervalComboBox"
                      Background="{DynamicResource InputBackground}"
                      Foreground="{DynamicResource TextPrimary}"
                      BorderBrush="{DynamicResource BorderPrimary}"
                      Padding="6,4" FontSize="12" Margin="0,0,0,12"
                      KeyboardNavigation.DirectionalNavigation="Cycle">
                <ComboBoxItem Tag="Sec10">10 seconds</ComboBoxItem>
                <ComboBoxItem Tag="Sec30">30 seconds</ComboBoxItem>
                <ComboBoxItem Tag="Sec60">60 seconds</ComboBoxItem>
                <ComboBoxItem Tag="Disabled">Disabled</ComboBoxItem>
            </ComboBox>

            <!-- Confirmation Prompts -->
            <TextBlock Grid.Row="2" Grid.Column="0"
                       Text="Confirmation Prompts"
                       Foreground="{DynamicResource TextSecondary}" FontSize="12"
                       VerticalAlignment="Center">
                <TextBlock.ToolTip>
                    <ToolTip Content="Show confirmation before destructive operations (cleanup, restore, reset)."/>
                </TextBlock.ToolTip>
            </TextBlock>
            <CheckBox x:Name="ChkRequireConfirmationDestructive"
                      Grid.Row="2" Grid.Column="1"
                      automation:AutomationProperties.AutomationId="RequireConfirmationDestructiveCheckBox"
                      Content="Require confirmation for destructive operations"
                      VerticalAlignment="Center"/>
        </Grid>
    </GroupBox>
    ```

    DO NOT: Change existing Refresh Interval in General Settings - that one is for current use, this is for default
  </action>
  <verify>
    dotnet build src/WsusManager.App/WsusManager.App.csproj succeeds
  </verify>
  <done>
    Behavior GroupBox added with Persist Window State CheckBox, Refresh Interval ComboBox, Confirmation Prompts CheckBox, all with ToolTips
  </done>
</task>

<task type="auto">
  <name>Add Advanced section with 3 settings and Reset button</name>
  <files>src/WsusManager.App/Views/SettingsDialog.xaml</files>
  <action>
    Add an Advanced GroupBox section with Reset to Defaults button:

    ```xml
    <!-- Section: Advanced -->
    <GroupBox Grid.Row="5" Header="Advanced" Margin="0,0,0,16">
        <GroupBox.HeaderTemplate>
            <DataTemplate>
                <TextBlock Text="{Binding}" FontWeight="SemiBold" FontSize="13"
                           Foreground="{DynamicResource TextSecondary}"/>
            </DataTemplate>
        </GroupBox.HeaderTemplate>
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="160"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <!-- WinRM Timeout Seconds -->
            <TextBlock Grid.Row="0" Grid.Column="0"
                       Text="WinRM Timeout (sec)"
                       Foreground="{DynamicResource TextSecondary}" FontSize="12"
                       VerticalAlignment="Center" Margin="0,0,0,12">
                <TextBlock.ToolTip>
                    <ToolTip Content="WinRM operation timeout in seconds (10-300)."/>
                </TextBlock.ToolTip>
            </TextBlock>
            <TextBox x:Name="TxtWinRMTimeoutSeconds"
                     Grid.Row="0" Grid.Column="1"
                     automation:AutomationProperties.AutomationId="WinRMTimeoutSecondsTextBox"
                     Background="{DynamicResource InputBackground}"
                     Foreground="{DynamicResource TextPrimary}"
                     BorderBrush="{DynamicResource BorderPrimary}"
                     Padding="6,4" FontSize="12" Margin="0,0,0,12"
                     InputScope="Number"/>

            <!-- WinRM Retry Count -->
            <TextBlock Grid.Row="1" Grid.Column="0"
                       Text="WinRM Retry Count"
                       Foreground="{DynamicResource TextSecondary}" FontSize="12"
                       VerticalAlignment="Center" Margin="0,0,0,12">
                <TextBlock.ToolTip>
                    <ToolTip Content="Number of WinRM operation retry attempts (1-10)."/>
                </TextBlock.ToolTip>
            </TextBlock>
            <TextBox x:Name="TxtWinRMRetryCount"
                     Grid.Row="1" Grid.Column="1"
                     automation:AutomationProperties.AutomationId="WinRMRetryCountTextBox"
                     Background="{DynamicResource InputBackground}"
                     Foreground="{DynamicResource TextPrimary}"
                     BorderBrush="{DynamicResource BorderPrimary}"
                     Padding="6,4" FontSize="12" Margin="0,0,0,12"
                     InputScope="Number"/>

            <!-- Spacer -->
            <Border Grid.Row="2" Grid.ColumnSpan="2" Height="8"/>

            <!-- Reset to Defaults Button -->
            <Button Grid.Row="3" Grid.ColumnSpan="2"
                    x:Name="BtnResetToDefaults"
                    Content="Reset to Defaults"
                    Style="{StaticResource BtnSec}"
                    automation:AutomationProperties.AutomationId="ResetToDefaultsButton"
                    Padding="16,6" HorizontalAlignment="Left"
                    Click="BtnResetToDefaults_Click">
                <Button.ToolTip>
                    <ToolTip Content="Reset all settings to their default values. This cannot be undone."/>
                </Button.ToolTip>
            </Button>
        </Grid>
    </GroupBox>
    ```

    DO NOT: Make Reset button the default button - Save should remain the default (IsDefault="True")
  </action>
  <verify>
    dotnet build src/WsusManager.App/WsusManager.App.csproj succeeds
  </verify>
  <done>
    Advanced GroupBox added with WinRM Timeout TextBox, WinRM Retry Count TextBox, Reset to Defaults Button, all with ToolTips
  </done>
</task>

<task type="auto">
  <name>Adjust Grid row definitions and window height</name>
  <files>src/WsusManager.App/Views/SettingsDialog.xaml</files>
  <action>
    Update the main Grid row definitions and window height to accommodate new sections:

    1. Update Window Height to accommodate more content (or enable ScrollViewer):
       Change `Height="620"` to `Height="720"` (add ~100px for new sections)

    2. Or better, wrap content in ScrollViewer for flexibility:
       ```xml
       <ScrollViewer VerticalScrollBarVisibility="Auto">
           <Grid Margin="24" KeyboardNavigation.TabNavigation="Continue">
               <!-- existing content with updated RowDefinitions -->
           </Grid>
       </ScrollViewer>
       ```

    3. Update Grid.RowDefinitions to include new rows:
       - Add RowDefinition for each new GroupBox (Rows 2, 3, 4, 5)
       - Adjust subsequent row indices for existing sections (Appearance becomes Row 6, Buttons become Row 7)

    4. Update existing section Grid.Row values:
       - Header: Grid.Row="0" (unchanged)
       - Server Mode: Grid.Row="1" (unchanged)
       - Operations: Grid.Row="2" (new)
       - Logging: Grid.Row="3" (new)
       - Behavior: Grid.Row="4" (new)
       - Advanced: Grid.Row="5" (new)
       - Appearance: Grid.Row="6" (was 3)
       - Buttons: Grid.Row="7" (was 5)

    DO NOT: Change existing section content - only update Grid.Row indices
  </action>
  <verify>
    dotnet build src/WsusManager.App/WsusManager.App.csproj succeeds
  </verify>
  <done>
    Grid row definitions updated, ScrollViewer added (optional), window height increased to fit all sections
  </done>
</task>

</tasks>

<verification>
1. Build succeeds: dotnet build src/WsusManager.App
2. 4 GroupBox sections exist: Operations, Logging, Behavior, Advanced
3. All 8 new settings have controls (3 ComboBox, 3 TextBox, 2 CheckBox)
4. All controls have AutomationIds for testing
5. All controls have ToolTips for context
6. Reset to Defaults button in Advanced section
7. Two-column layout used (160px label, * control)
8. ScrollViewer wraps content if window height exceeded
</verification>

<success_criteria>
SettingsDialog redesigned with 4 sections containing all 8 new settings. Proper layout, tooltips, and automation IDs. Ready for code-behind implementation.
</success_criteria>

<output>
After completion, create `.planning/phases/28-settings-expansion/28-03-SUMMARY.md`
</output>

# Phase 17 Plan 01: Theme Content and Picker

## Goal

Create 5 additional dark-family theme color dictionaries (Just Black, Slate, Serenity, Rose, Classic Blue), add a swatch-based Appearance section to the Settings dialog with live preview, and wire Cancel-to-revert and Save-to-persist behavior.

## Requirements Covered

THEME-01, THEME-02, THEME-03, PICK-01, PICK-02, PICK-03, PICK-04, PICK-05, PICK-06

## Tasks

### Task 1: Create 5 Theme XAML Files

Create one ResourceDictionary per theme, each defining all 19 Color/SolidColorBrush pairs from DefaultDark.xaml. All themes are dark-family. All text-on-background combinations must meet WCAG 2.1 AA (4.5:1 contrast ratio).

**Files to create:**
- `src/WsusManager.App/Themes/JustBlack.xaml`
- `src/WsusManager.App/Themes/Slate.xaml`
- `src/WsusManager.App/Themes/Serenity.xaml`
- `src/WsusManager.App/Themes/Rose.xaml`
- `src/WsusManager.App/Themes/ClassicBlue.xaml`

**Color palettes:**

**Just Black** — True OLED black, pure #000000 backgrounds, minimal contrast borders, white text, green accent.
- PrimaryBackground: #000000
- NavBackground: #0A0A0A
- CardBackground: #111111
- InputBackground: #000000
- BorderPrimary: #222222
- BorderSubtle: #111111
- AccentBrush: #4CAF50
- AccentHover: #66BB6A
- StatusSuccess/Warning/Error: same as DefaultDark (functional colors stay consistent)
- TextPrimary: #FFFFFF
- TextSecondary: #9E9E9E
- TextMuted: #616161
- ButtonPrimary: #238636 / ButtonPrimaryHover: #2EA043
- ButtonDanger: #DA3633 / ButtonDangerHover: #F85149
- NavActiveBackground: #1A1A1A

**Slate** — Cool blue-gray tones, steel accent.
- PrimaryBackground: #1B2127
- NavBackground: #222A32
- CardBackground: #2A333C
- InputBackground: #1B2127
- BorderPrimary: #3A444E
- BorderSubtle: #2A333C
- AccentBrush: #78909C
- AccentHover: #90A4AE
- TextPrimary: #ECEFF1
- TextSecondary: #90A4AE
- TextMuted: #546E7A
- ButtonPrimary: #37474F / ButtonPrimaryHover: #455A64
- ButtonDanger: #DA3633 / ButtonDangerHover: #F85149
- NavActiveBackground: #2A333C

**Serenity** — Muted teal/cyan accent on dark background.
- PrimaryBackground: #0F1419
- NavBackground: #151C23
- CardBackground: #1C252E
- InputBackground: #0F1419
- BorderPrimary: #2A3540
- BorderSubtle: #1C252E
- AccentBrush: #4DB6AC
- AccentHover: #80CBC4
- TextPrimary: #E0F2F1
- TextSecondary: #80CBC4
- TextMuted: #4A6670
- ButtonPrimary: #00695C / ButtonPrimaryHover: #00897B
- ButtonDanger: #DA3633 / ButtonDangerHover: #F85149
- NavActiveBackground: #1C252E

**Rose** — Warm rose/pink accent on dark background.
- PrimaryBackground: #1A1118
- NavBackground: #221820
- CardBackground: #2C1F28
- InputBackground: #1A1118
- BorderPrimary: #3D2E38
- BorderSubtle: #2C1F28
- AccentBrush: #F06292
- AccentHover: #F48FB1
- TextPrimary: #FCE4EC
- TextSecondary: #F48FB1
- TextMuted: #6D4C5E
- ButtonPrimary: #AD1457 / ButtonPrimaryHover: #C2185B
- ButtonDanger: #DA3633 / ButtonDangerHover: #F85149
- NavActiveBackground: #2C1F28

**Classic Blue** — Traditional navy/royal blue corporate feel.
- PrimaryBackground: #0D1525
- NavBackground: #111B2E
- CardBackground: #182238
- InputBackground: #0D1525
- BorderPrimary: #253350
- BorderSubtle: #182238
- AccentBrush: #42A5F5
- AccentHover: #64B5F6
- TextPrimary: #E3F2FD
- TextSecondary: #90CAF9
- TextMuted: #3D5A80
- ButtonPrimary: #1565C0 / ButtonPrimaryHover: #1976D2
- ButtonDanger: #DA3633 / ButtonDangerHover: #F85149
- NavActiveBackground: #182238

**Verification:** Each file compiles (build succeeds), defines all 19 key pairs, uses the same key names as DefaultDark.xaml.

### Task 2: Register Themes in ThemeService

Update `ThemeService._themeMap` to include all 6 themes. Add a static metadata dictionary that maps theme names to display names and swatch preview colors (for the picker UI).

**Files to modify:**
- `src/WsusManager.App/Services/ThemeService.cs`
- `src/WsusManager.App/Services/IThemeService.cs`

**Changes:**
1. Add 5 new entries to `_themeMap`
2. Add `ThemeInfo` record/class with `DisplayName`, `PreviewBackground` (hex), `PreviewAccent` (hex) properties
3. Add `GetThemeInfo(string themeName)` method to IThemeService/ThemeService
4. Add `IReadOnlyDictionary<string, ThemeInfo> ThemeInfos` property for UI binding

**Verification:** `AvailableThemes` returns 6 entries. `GetThemeInfo("DefaultDark")` returns display name "Default Dark".

### Task 3: Add Appearance Section to Settings Dialog

Add a theme picker UI to `SettingsDialog.xaml` and wire it up in code-behind.

**Files to modify:**
- `src/WsusManager.App/Views/SettingsDialog.xaml`
- `src/WsusManager.App/Views/SettingsDialog.xaml.cs`

**XAML changes:**
1. Increase dialog height to ~520px to accommodate Appearance section
2. Add a new row in the main Grid between the General Settings section and the Buttons row
3. Appearance section layout:
   - Section header: "Appearance" (TextBlock, same style as "Server Mode" label)
   - 3x2 UniformGrid (or WrapPanel) of theme swatch items
   - Each swatch: a Border (40x32 or similar) with rounded corners, filled with the theme's PrimaryBackground color, a small accent-colored bar at the bottom, theme name TextBlock below
   - Active theme swatch has a highlighted accent-colored border (2px)
   - Clicking a swatch applies the theme immediately (live preview)

**Code-behind changes:**
1. Accept `IThemeService` as a constructor parameter (in addition to `AppSettings`)
2. On construction: capture `themeService.CurrentTheme` as `_entryTheme`
3. Build swatch grid dynamically from `themeService.ThemeInfos`
4. On swatch click: call `themeService.ApplyTheme(themeName)`, update active indicator
5. On Cancel: call `themeService.ApplyTheme(_entryTheme)` to revert
6. On Save: set `Result.SelectedTheme` to the currently previewed theme name

### Task 4: Update MainViewModel to Pass ThemeService to Settings Dialog

**Files to modify:**
- `src/WsusManager.App/ViewModels/MainViewModel.cs`

**Changes:**
1. Add `IThemeService` dependency to constructor (inject from DI)
2. In `OpenSettings()`: pass `_themeService` to `SettingsDialog` constructor
3. On Save: persist `updated.SelectedTheme` from dialog result
4. On Cancel: theme already reverted by dialog's Cancel handler (no extra work)

### Task 5: Update Tests

**Files to modify:**
- `src/WsusManager.Tests/Services/ThemeServiceTests.cs`

**New/updated tests:**
1. Update `AvailableThemes_HasExactlyOneEntry` to `AvailableThemes_HasSixEntries`
2. Add test: `GetThemeInfo_ReturnsInfoForAllThemes`
3. Add test: `GetThemeInfo_UnknownTheme_ReturnsNull`
4. Add test: `ApplyTheme_CaseInsensitive` (verify "defaultdark" works)
5. Add test: `ThemeInfos_ContainsDisplayNames` (verify display name differs from key)

**Verification:** All tests pass. Build succeeds with 0 warnings.

## Acceptance Criteria

1. Build compiles with 0 errors, 0 warnings
2. All existing + new tests pass
3. Settings dialog shows 6 theme swatches in an Appearance section
4. Clicking a swatch instantly changes the entire app's color scheme (live preview)
5. Cancel reverts to the theme active when Settings was opened
6. Save persists the selected theme to settings.json
7. App restores the saved theme on next startup (Phase 16 ThemeService already handles this)
8. Active theme swatch is visually distinguished (highlighted border)

## Order of Operations

Task 1 (theme files) and Task 2 (ThemeService registration) can run in parallel. Task 3 (UI) depends on Task 2. Task 4 (ViewModel wiring) depends on Task 3. Task 5 (tests) depends on Task 2.

Recommended sequence: Task 1 + Task 2 together, then Task 3, then Task 4, then Task 5.

# Plan 19-02: .editorconfig for Consistent Code Style

**Created:** 2026-02-21
**Status:** Ready for implementation
**Requirements:** QUAL-03

## Objective

Define IDE-agnostic code style rules using `.editorconfig` so all developers see consistent formatting regardless of editor choice.

## Success Criteria

1. `.editorconfig` file exists in solution root
2. All developers using VS, VS Code, or Rider see same formatting
3. Code style violations appear in editor with squigglies
4. Build enforces style rules via `EnforceCodeStyleInBuild`
5. Naming conventions enforced at compile time

## Implementation

### Step 1: Create .editorconfig

**Location:** `/CSharp/src/.editorconfig`

**Purpose:** Define formatting and naming rules for all text files in solution

```ini
###############################
# Top-level .editorconfig file #
###############################

# Default settings for all files
root = true

# All files
[*]
charset = utf-8
indent_style = space
indent_size = 4
insert_final_newline = true
trim_trailing_whitespace = true
end_of_line = crlf

# Code files
[*.{cs,csx,vb,vbx}]
indent_size = 4

# XML project files
[*.{csproj,vbproj,vcxproj,vcxproj.filters,proj,projitems,shproj}]
indent_size = 2

# XML config files
[*.{props,targets,ruleset,config,nuspec,resx,vsixmanifest,vsct}]
indent_size = 2

# JSON files
[*.json]
indent_size = 2

# YAML files
[*.{yml,yaml}]
indent_size = 2

# Markdown files
[*.md]
trim_trailing_whitespace = false

# C# files
[*.cs]

# New line preferences
csharp_new_line_before_open_brace = all
csharp_new_line_before_else = true
csharp_new_line_before_catch = true
csharp_new_line_before_finally = true

# Indentation preferences
csharp_indent_case_contents = true
csharp_indent_switch_labels = true

# Space preferences
csharp_space_after_cast = false
csharp_space_after_keywords_in_control_flow_statements = true

# Naming conventions
dotnet_naming_rule.interface_should_be_begins_with_i.severity = warning
dotnet_naming_rule.interface_should_be_begins_with_i.symbols = interface
dotnet_naming_rule.interface_should_be_begins_with_i.style = begins_with_i

dotnet_naming_rule.types_should_be_pascal_case.severity = warning
dotnet_naming_rule.types_should_be_pascal_case.symbols = types
dotnet_naming_rule.types_should_be_pascal_case.style = pascal_case

dotnet_naming_rule.private_fields_should_be_camel_case_with_underscore.severity = warning
dotnet_naming_rule.private_fields_should_be_camel_case_with_underscore.symbols = private_fields
dotnet_naming_rule.private_fields_should_be_camel_case_with_underscore.style = camel_case_with_underscore

# Symbol specifications
dotnet_naming_symbols.interface.applicable_kinds = interface
dotnet_naming_symbols.interface.applicable_accessibilities = public, internal, private, protected, protected_internal, private_protected

dotnet_naming_symbols.types.applicable_kinds = class, struct, interface, enum
dotnet_naming_symbols.types.applicable_accessibilities = public, internal, private, protected, protected_internal, private_protected

dotnet_naming_symbols.private_fields.applicable_kinds = field
dotnet_naming_symbols.private_fields.applicable_accessibilities = private

# Naming styles
dotnet_naming_style.pascal_case.capitalization = pascal_case

dotnet_naming_style.begins_with_i.required_prefix = I
dotnet_naming_style.begins_with_i.capitalization = pascal_case

dotnet_naming_style.camel_case_with_underscore.required_prefix = _
dotnet_naming_style.camel_case_with_underscore.capitalization = camel_case

# Language keywords vs BCL types preferences
dotnet_style_qualification_for_field = false:suggestion
dotnet_style_qualification_for_property = false:suggestion
dotnet_style_qualification_for_method = false:suggestion
dotnet_style_qualification_for_event = false:suggestion

# Modifier preferences
dotnet_style_require_accessibility_modifiers = always:suggestion
```

### Step 2: Configure Using Directives

**Add to .editorconfig (C# section):**

```ini
# Using directive preferences
csharp_using_directive_placement = outside_namespace:suggestion
dotnet_sort_system_directives_first = true
```

**Explanation:**
- `outside_namespace:suggestion` - Encourages using directives at file scope (not inside namespace)
- `sort_system_directives_first` - Sorts `using System;` before `using Microsoft;` before third-party

**Example correct ordering:**

```csharp
using System;
using System.Collections.Generic;
using System.Threading.Tasks;
using Microsoft.Extensions.DependencyInjection;
using Microsoft.Extensions.Logging;
using Polly;

namespace WsusManager.Core.Services
{
    // ...
}
```

### Step 3: Configure Build Enforcement

**Update Directory.Build.props** (from Plan 19-01):

```xml
<PropertyGroup>
  <!-- Enforce code style in build (not just IDE) -->
  <EnforceCodeStyleInBuild>true</EnforceCodeStyleInBuild>

  <!-- Style rule severity -->
  <DotNetSortSystemDirectivesFirst>true</DotNetSortSystemDirectivesFirst>

  <!-- Naming convention severity -->
  <NamingRuleSeverity>Warning</NamingRuleSeverity>
</PropertyGroup>
```

**Result:** Build produces warnings for:
- Misnamed interfaces (not starting with `I`)
- PascalCase violations on types
- Private fields not using `_camelCase`
- Misordered using directives

### Step 4: Editor-Specific Configurations

**Visual Studio Code:**
Create `/CSharp/src/.vscode/settings.json`:

```json
{
  "editor.formatOnSave": true,
  "editor.defaultFormatter": "ms-dotnettools.csharp",
  "[csharp]": {
    "editor.defaultFormatter": "ms-dotnettools.csharp"
  },
  "omnisharp.enableRoslynAnalyzers": true,
  "omnisharp.enableEditorConfigSupport": true
}
```

**Visual Studio 2022:**
No config needed - .editorconfig is native. Verify:
- Tools → Options → Text Editor → C# → Code Style → General
- Check "Enable .editorconfig support"

**Rider:**
No config needed - .editorconfig is native. Verify:
- Settings → Editor → Code Style → C# → Enable EditorConfig support

### Step 5: Existing Code Reformatting

**One-time bulk reformat:**

```bash
# Install dotnet-format tool
dotnet tool install -g dotnet-format

# Reformat entire solution
dotnet-format WsusManager.sln --folder --include src --verbosity diagnostic

# Verify build passes
dotnet build --configuration Release
```

**Note:** This will format all code to match .editorconfig rules. Review changes before committing.

### Step 6: Naming Convention Examples

**Correct (per .editorconfig):**

```csharp
// Interface: PascalCase, starts with I
public interface IHealthService { }

// Class: PascalCase
public class HealthChecker { }

// Private field: _camelCase
private readonly ILogger _logger;
private readonly string _connectionString;

// Public property: PascalCase
public string StatusMessage { get; set; }

// Public method: PascalCase
public async Task<bool> CheckHealthAsync() { }

// Async method: ends with Async
public async Task ExecuteAsync() { }

// Constants: PascalCase
public const int MaxRetryAttempts = 3;

// Local variables: camelCase
var retryCount = 0;
var isConnected = true;
```

**Incorrect (will generate warnings):**

```csharp
// ❌ Interface missing I prefix
public interface HealthService { }

// ❌ Class not PascalCase
public class healthChecker { }

// ❌ Private field not _camelCase
private readonly ILogger logger;
private readonly string m_connectionString;

// ❌ Public property not PascalCase
public string status_message { get; set; }
```

### Step 7: Verification Checklist

**Manual verification:**

1. [ ] Open any `.cs` file in VS Code - see formatting on save
2. [ ] Open any `.cs` file in Visual Studio 2022 - see squigglies for violations
3. [ ] Rename a private field to violate naming - see warning
4. [ ] Run `dotnet build` - see style warnings in output
5. [ ] Reorder using directives - auto-fix on save

**Automated verification:**

```bash
# Build and check for style warnings
dotnet build --configuration Release 2>&1 | grep -i "style"

# Should see zero output if code conforms
```

## Documentation

**Update CONTRIBUTING.md:**

```markdown
## Code Style

This project uses [.editorconfig](/.editorconfig) to define consistent code style across all editors.

### Naming Conventions

| Symbol Type | Convention | Example |
|-------------|------------|---------|
| Interfaces | PascalCase, prefixed with `I` | `IHealthService` |
| Classes/Structs/Enums | PascalCase | `HealthChecker`, `SyncProfile` |
| Methods | PascalCase | `CheckHealthAsync()` |
| Properties | PascalCase | `StatusMessage` |
| Private fields | `_camelCase` (underscore prefix) | `_logger`, `_connectionString` |
| Constants | PascalCase | `MaxRetryAttempts` |
| Local variables | camelCase | `retryCount`, `isConnected` |
| Async methods | PascalCase, suffixed with `Async` | `ExecuteAsync()` |

### Formatting Rules

- Indent: 4 spaces (no tabs)
- Braces: K&R style (opening brace on same line)
- Newlines: Line ending at end of file
- Using directives: Outside namespace, System first, then alphabetical

### Auto-Formatting

All editors auto-format on save when .editorconfig is supported:
- **Visual Studio Code:** Automatic (C# Dev Kit extension)
- **Visual Studio 2022:** Automatic (native)
- **Rider:** Automatic (native)

To format manually:
```bash
dotnet-format WsusManager.sln
```
```

## Risk Mitigation

| Risk | Impact | Mitigation |
|------|--------|------------|
| Developer resistance to style changes | Medium | One-time bulk format, document exceptions |
| Editor not supporting .editorconfig | Low | VS Code, VS 2022, Rider all support it |
| Naming conflicts with existing code | Medium | Start with warning severity, phase to error |
| Bulk format changes too large for PR | Low | Use separate PR for formatting only |

## Dependencies

- Plan 19-01 (creates Directory.Build.props for build enforcement)
- None (can proceed in parallel with 19-01)

## Time Estimate

- Step 1 (.editorconfig creation): 30 minutes
- Step 2 (using directives): 15 minutes
- Step 3 (build enforcement): 15 minutes
- Step 4 (editor configs): 30 minutes
- Step 5 (bulk reformat): 1 hour (includes review)
- Step 6 (documentation): 30 minutes
- Step 7 (verification): 30 minutes
- **Total:** 3-4 hours

## References

- [.editorconfig Documentation](https://learn.microsoft.com/en-us/visualstudio/ide/create-portable-custom-editor-options)
- [C# Naming Conventions](https://learn.microsoft.com/en-us/dotnet/csharp/fundamentals/coding-style/coding-conventions)
- [dotnet-format Tool](https://github.com/dotnet/format)

---

*Plan: 19-02 - .editorconfig for Consistent Code Style*
*Status: Complete*

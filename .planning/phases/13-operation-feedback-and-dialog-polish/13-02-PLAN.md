---
phase: 13-operation-feedback-and-dialog-polish
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/WsusManager.App/Views/InstallDialog.xaml
  - src/WsusManager.App/Views/InstallDialog.xaml.cs
  - src/WsusManager.App/Views/TransferDialog.xaml
  - src/WsusManager.App/Views/TransferDialog.xaml.cs
  - src/WsusManager.App/Views/ScheduleTaskDialog.xaml
  - src/WsusManager.App/Views/ScheduleTaskDialog.xaml.cs
autonomous: true
requirements: [DLG-01, DLG-02, DLG-03, DLG-04]

must_haves:
  truths:
    - "Install dialog Install button is disabled when installer path is empty or does not exist, and a red validation message is shown"
    - "Transfer dialog OK button is disabled when in Import mode and source path is empty"
    - "Schedule Task dialog Create Task button is disabled when task name or password is empty, with validation hint visible"
    - "All three dialogs use the same dark theme colors and spacing patterns from DarkTheme.xaml"
  artifacts:
    - path: "src/WsusManager.App/Views/InstallDialog.xaml"
      provides: "Validation TextBlock and Install button with x:Name for disable binding"
      contains: "ValidationText"
    - path: "src/WsusManager.App/Views/InstallDialog.xaml.cs"
      provides: "TextChanged handler that enables/disables Install button based on path validation"
      contains: "ValidateInputs"
    - path: "src/WsusManager.App/Views/TransferDialog.xaml.cs"
      provides: "Validation logic for Import source path"
      contains: "ValidateInputs"
    - path: "src/WsusManager.App/Views/ScheduleTaskDialog.xaml.cs"
      provides: "Validation logic for task name, time, and password"
      contains: "ValidateInputs"
  key_links:
    - from: "InstallDialog TxtInstallerPath.TextChanged"
      to: "BtnInstall.IsEnabled"
      via: "ValidateInputs method"
      pattern: "ValidateInputs"
    - from: "TransferDialog source path TextChanged"
      to: "BtnOk.IsEnabled"
      via: "ValidateInputs method"
      pattern: "ValidateInputs"
    - from: "ScheduleTaskDialog field changes"
      to: "BtnCreate.IsEnabled"
      via: "ValidateInputs method"
      pattern: "ValidateInputs"
---

<objective>
Add real-time input validation to all dialogs so the primary action button is disabled when required fields are missing or invalid. Show visible validation feedback (red text hints) so the admin knows what needs to be fixed.

Purpose: Currently all dialogs allow clicking OK with invalid inputs, then show a MessageBox error. This plan shifts validation to real-time inline feedback, preventing the submit entirely until inputs are valid.
Output: Updated Install, Transfer, and Schedule Task dialogs with real-time validation and consistent styling.
</objective>

<execution_context>
@/home/anthonyscry/.claude/get-shit-done/workflows/execute-plan.md
@/home/anthonyscry/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

@src/WsusManager.App/Views/InstallDialog.xaml
@src/WsusManager.App/Views/InstallDialog.xaml.cs
@src/WsusManager.App/Views/TransferDialog.xaml
@src/WsusManager.App/Views/TransferDialog.xaml.cs
@src/WsusManager.App/Views/ScheduleTaskDialog.xaml
@src/WsusManager.App/Views/ScheduleTaskDialog.xaml.cs
@src/WsusManager.App/Themes/DarkTheme.xaml
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add real-time validation to Install dialog (DLG-01)</name>
  <files>
    src/WsusManager.App/Views/InstallDialog.xaml
    src/WsusManager.App/Views/InstallDialog.xaml.cs
  </files>
  <action>
**InstallDialog.xaml changes:**

1. Give the Install button an `x:Name="BtnInstall"` and set `IsEnabled="False"` as default (starts disabled).
2. Add a validation TextBlock below the SA Password field (before the Buttons StackPanel):
   - `x:Name="TxtValidation"`, Foreground="#F85149" (Red), FontSize="11", TextWrapping="Wrap", Margin="0,8,0,0"
   - Text initially: "Enter installer path and SA password to continue."
3. Add `TextChanged="Input_Changed"` to `TxtInstallerPath` TextBox.
4. Add `PasswordChanged="Input_Changed"` to `PwdSaPassword` PasswordBox.

**InstallDialog.xaml.cs changes:**

1. Add an `Input_Changed` event handler (works for both TextChanged and PasswordChanged):
   ```csharp
   private void Input_Changed(object sender, RoutedEventArgs e) => ValidateInputs();
   ```

2. Add a `ValidateInputs()` method:
   - Check installer path: not empty AND directory exists AND contains `SQLEXPRADV_x64_ENU.exe` (or any `.exe` file matching SQL pattern). For simplicity, just check that the directory exists — the service does deeper validation.
   - Check SA password: not empty, length >= 15
   - If path is empty: show "Installer path is required."
   - If path doesn't exist as a directory: show "Installer directory not found."
   - If password is empty: show "SA password is required."
   - If password length < 15: show "SA password must be at least 15 characters."
   - If all valid: clear validation text, enable BtnInstall
   - If any invalid: show first error, disable BtnInstall

3. Call `ValidateInputs()` at the end of the constructor (after InitializeComponent) to set initial state.

4. Update `BrowseInstallerPath_Click` to call `ValidateInputs()` after setting path.

5. Keep the `Ok_Click` validation as a safety net but the button should already be disabled for invalid inputs.

**DLG-03 consistency:** Ensure the dialog uses only theme resources (BgDark, BgInput, Text1, Text2, Border, BtnGreen, BtnSec). Already looks correct from current XAML — just verify no hardcoded colors.
  </action>
  <verify>
1. `dotnet build src/WsusManager.App/WsusManager.App.csproj` — 0 errors
2. Grep for "ValidateInputs" in InstallDialog.xaml.cs — method exists
3. Grep for "BtnInstall" in InstallDialog.xaml — button has x:Name
4. Grep for "TxtValidation" in InstallDialog.xaml — validation text exists
  </verify>
  <done>
- Install button disabled by default when dialog opens
- Install button enables only when path exists and password >= 15 chars
- Red validation text shows what's missing/wrong
- Browse button triggers re-validation
  </done>
</task>

<task type="auto">
  <name>Task 2: Add real-time validation to Transfer and Schedule dialogs (DLG-02, DLG-03, DLG-04)</name>
  <files>
    src/WsusManager.App/Views/TransferDialog.xaml
    src/WsusManager.App/Views/TransferDialog.xaml.cs
    src/WsusManager.App/Views/ScheduleTaskDialog.xaml
    src/WsusManager.App/Views/ScheduleTaskDialog.xaml.cs
  </files>
  <action>
**TransferDialog (DLG-02):**

XAML changes:
1. Add `x:Name="BtnOk"` already exists — good. Set `IsEnabled="True"` (Export mode needs no required paths, all are optional).
2. Add a validation TextBlock before the Buttons StackPanel:
   - `x:Name="TxtValidation"`, Foreground="#F85149", FontSize="11", Margin="0,4,0,0"
3. Add `TextChanged="Input_Changed"` to `TxtSourcePath` and `TxtDestPath` TextBoxes.

Code-behind changes:
1. Add `Input_Changed` handler that calls `ValidateInputs()`.
2. Add `ValidateInputs()`:
   - In Export mode: always valid (all export paths are optional). Clear validation, enable BtnOk.
   - In Import mode: source path must not be empty. If empty: show "Source path is required for import.", disable BtnOk. If not empty: clear validation, enable BtnOk.
3. Call `ValidateInputs()` in `Direction_Changed` (when switching between Export/Import).
4. Remove the MessageBox validation from `Ok_Click` for source path (now handled by real-time validation). Keep Ok_Click simple — just build the result and close.

**ScheduleTaskDialog (DLG-04):**

XAML changes:
1. Give the Create Task button `x:Name="BtnCreate"` and set `IsEnabled="False"`.
2. Add a validation TextBlock before the Buttons StackPanel:
   - `x:Name="TxtValidation"`, Foreground="#F85149", FontSize="11", Margin="0,4,0,0"
3. Add `TextChanged="Input_Changed"` to TxtTaskName, TxtTime, TxtDayOfMonth TextBoxes.
4. Add `PasswordChanged="Input_Changed"` to PwdPassword PasswordBox.

Code-behind changes:
1. Add `Input_Changed` handler that calls `ValidateInputs()`.
2. Add `ValidateInputs()`:
   - Task name must not be empty
   - Time must match HH:mm format (use TimeSpan.TryParse or regex `^\d{2}:\d{2}$`)
   - When Monthly: day of month must be 1-31
   - Password must not be empty
   - First failing rule sets validation text and disables BtnCreate
   - All valid: clear validation text, enable BtnCreate
3. Call `ValidateInputs()` at end of constructor.
4. Call `ValidateInputs()` in `ScheduleType_Changed`.
5. Remove MessageBox validations from `Ok_Click` (now handled by real-time validation). Keep Ok_Click as simple build-result-and-close.

**DLG-03 consistency check:** All three dialogs already use StaticResource references from DarkTheme.xaml. The validation TextBlock uses hardcoded "#F85149" which matches the Red resource. This is acceptable for a simple label — no style needed. Verify no other hardcoded colors exist in the dialog XAMLs.

After all changes, run `dotnet build` and `dotnet test` to confirm everything compiles and passes.
  </action>
  <verify>
1. `dotnet build src/WsusManager.App/WsusManager.App.csproj` — 0 errors
2. `dotnet test` — all tests pass
3. Grep "ValidateInputs" in TransferDialog.xaml.cs — exists
4. Grep "ValidateInputs" in ScheduleTaskDialog.xaml.cs — exists
5. Grep "TxtValidation" in TransferDialog.xaml — exists
6. Grep "TxtValidation" in ScheduleTaskDialog.xaml — exists
7. Grep "BtnCreate" in ScheduleTaskDialog.xaml — exists with IsEnabled="False"
  </verify>
  <done>
- Transfer dialog: OK disabled in Import mode when source path empty; always enabled in Export mode
- Schedule dialog: Create Task disabled until task name, valid time, and password are provided
- Red inline validation text visible when inputs are invalid
- No MessageBox popups for basic validation — caught inline
- All dialogs use consistent dark theme colors
- Build passes, all tests pass
  </done>
</task>

</tasks>

<verification>
1. `dotnet build` — 0 errors
2. `dotnet test` — all tests pass
3. Install dialog: BtnInstall disabled by default, validation TextBlock present
4. Transfer dialog: validation for Import source path, TxtValidation present
5. Schedule dialog: BtnCreate disabled by default, validation for name/time/password
6. All validation TextBlocks use #F85149 (red) foreground
7. No hardcoded non-theme colors in dialog XAMLs (except validation red)
</verification>

<success_criteria>
- Install dialog Install button disabled until path exists and password >= 15 chars
- Transfer dialog OK button disabled in Import mode when source path empty
- Schedule Task dialog Create button disabled until name, time, and password valid
- All dialogs show red inline validation hints
- No runtime errors or compilation warnings
- All tests pass
</success_criteria>

<output>
After completion, create `.planning/phases/13-operation-feedback-and-dialog-polish/13-02-SUMMARY.md`
</output>

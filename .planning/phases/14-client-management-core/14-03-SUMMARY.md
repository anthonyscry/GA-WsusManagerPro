---
phase: 14-client-management-core
plan: 03
subsystem: gui-client-management
tags: [wpf, mvvm, client-management, winrm, di-registration]
dependency_graph:
  requires: [14-02]
  provides: [client-tools-panel, client-management-commands, di-wiring]
  affects: [MainViewModel, MainWindow.xaml, Program.cs]
tech_stack:
  added: []
  patterns: [RelayCommand-CanExecute, ObservableProperty-partial-method, NavigateCommand-panel-pattern]
key_files:
  created: []
  modified:
    - src/WsusManager.App/ViewModels/MainViewModel.cs
    - src/WsusManager.App/Views/MainWindow.xaml
    - src/WsusManager.App/Program.cs
decisions:
  - "Navigate(ClientTools) called before RunOperationAsync in all remote commands — dialog-before-panel pattern satisfied (no dialog needed here, just navigate)"
  - "LookupErrorCode is synchronous and does not go through RunOperationAsync — local dictionary lookup only, sets ErrorCodeResult property directly"
  - "ErrorCodeResult TextBox always visible — simpler UX than hiding/showing, starts empty and fills on first lookup"
  - "OnClientHostnameChanged partial method used to notify CanExecute when hostname changes — clean CommunityToolkit.Mvvm pattern, no extra dependencies"
metrics:
  duration_minutes: 2
  completed_date: "2026-02-21"
  tasks: 2
  files_modified: 3
---

# Phase 14 Plan 03: Client Management GUI Wiring Summary

Wire the Client Management GUI into the application — adding the Client Tools panel, ViewModel commands, and DI registration to complete the Phase 14 feature set.

## What Was Built

Client management operations from Phase 14-02 (ClientService) are now accessible via a dedicated "Client Tools" panel in the GUI sidebar, with hostname-driven button enablement and a standalone error code lookup.

## Tasks Completed

### Task 1: MainViewModel + Program.cs (commit 287e5c2)

**Program.cs:**
- Added `WinRmExecutor` and `IClientService`/`ClientService` registrations in the DI container after Phase 6 block

**MainViewModel.cs:**
- Added `IClientService _clientService` field and constructor parameter
- Added 3 observable properties: `ClientHostname`, `ErrorCodeInput`, `ErrorCodeResult`
- Added `CanExecuteClientOperation()` helper: `!IsOperationRunning && !string.IsNullOrWhiteSpace(ClientHostname)`
- Added `OnClientHostnameChanged` partial method to notify CanExecute when hostname changes
- Added `IsClientToolsPanelVisible` computed visibility property
- Updated `IsOperationPanelVisible` to exclude "ClientTools" panel
- Updated `Navigate()` switch with "ClientTools" case and fires `OnPropertyChanged(nameof(IsClientToolsPanelVisible))`
- Added 5 commands: `RunClientCancelStuckJobs`, `RunClientForceCheckIn`, `RunClientTestConnectivity`, `RunClientDiagnostics` (all via `RunOperationAsync`), and `LookupErrorCode` (synchronous, sets `ErrorCodeResult` directly)
- Added Phase 14 commands to `NotifyCommandCanExecuteChanged()`

### Task 2: MainWindow.xaml (commit 06aa191)

**Sidebar:**
- Added "CLIENT TOOLS" category label and `BtnClientTools` nav button with active-highlight DataTrigger (matches Diagnostics/Database pattern)

**ClientToolsPanel:**
- Target Host card: hostname TextBox bound to `ClientHostname` with `UpdateSourceTrigger=PropertyChanged`
- Remote Operations card: 4 buttons (Cancel Stuck Jobs, Force Check-In, Test Connectivity, Run Diagnostics) bound to Phase 14 commands — disabled when no hostname or operation running
- Error Code Lookup card: error code input, Lookup button bound to `LookupErrorCodeCommand` (no hostname required), read-only Consolas result TextBox

## Verification

- `dotnet build src/WsusManager.sln` — 0 errors, 1 pre-existing warning (CS1998 in ClientServiceTests)
- `dotnet test src/WsusManager.Tests/` — 277/277 tests pass
- All 5 client commands generated by CommunityToolkit.Mvvm source generators
- DI container registers both `WinRmExecutor` and `IClientService`/`ClientService`
- `IsClientToolsPanelVisible` and `IsOperationPanelVisible` are mutually exclusive

## Deviations from Plan

None — plan executed exactly as written.

## Self-Check: PASSED
